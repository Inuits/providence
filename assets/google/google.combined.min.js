/*! CollectiveAccess Providence 2015-06-02 */
function GeolocationMarker(a,b,c){var d={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:new google.maps.MarkerImage("https://google-maps-utility-library-v3.googlecode.com/svn/trunk/geolocationmarker/images/gpsloc.png",new google.maps.Size(34,34),null,new google.maps.Point(8,8),new google.maps.Size(17,17)),optimized:!1,position:new google.maps.LatLng(0,0),title:"Current location",zIndex:2};b&&(d=this.copyOptions_(d,b));var e={clickable:!1,radius:0,strokeColor:"1bb6ff",strokeOpacity:.4,fillColor:"61a0bf",fillOpacity:.4,strokeWeight:1,zIndex:1};c&&(e=this.copyOptions_(e,c)),this.marker_=new google.maps.Marker(d),this.circle_=new google.maps.Circle(e),this.accuracy=null,this.position=null,this.map=null,this.set("minimum_accuracy",null),this.set("position_options",{enableHighAccuracy:!0,maximumAge:1e3}),this.circle_.bindTo("map",this.marker_),a&&this.setMap(a)}function ClusterIcon(a,b){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.cluster_=a,this.className_=a.getMarkerClusterer().getClusterClass(),this.styles_=b,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(a.getMap())}function Cluster(a){this.markerClusterer_=a,this.map_=a.getMap(),this.gridSize_=a.getGridSize(),this.minClusterSize_=a.getMinimumClusterSize(),this.averageCenter_=a.getAverageCenter(),this.printable_=a.getPrintable(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,a.getStyles())}function MarkerClusterer(a,b,c){this.extend(MarkerClusterer,google.maps.OverlayView),b=b||[],c=c||{},this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.gridSize_=c.gridSize||60,this.minClusterSize_=c.minimumClusterSize||2,this.maxZoom_=c.maxZoom||null,this.styles_=c.styles||[],this.title_=c.title||"",this.zoomOnClick_=!0,void 0!==c.zoomOnClick&&(this.zoomOnClick_=c.zoomOnClick),this.averageCenter_=!1,void 0!==c.averageCenter&&(this.averageCenter_=c.averageCenter),this.ignoreHidden_=!1,void 0!==c.ignoreHidden&&(this.ignoreHidden_=c.ignoreHidden),this.printable_=!1,void 0!==c.printable&&(this.printable_=c.printable),this.imagePath_=c.imagePath||MarkerClusterer.IMAGE_PATH,this.imageExtension_=c.imageExtension||MarkerClusterer.IMAGE_EXTENSION,this.imageSizes_=c.imageSizes||MarkerClusterer.IMAGE_SIZES,this.calculator_=c.calculator||MarkerClusterer.CALCULATOR,this.batchSize_=c.batchSize||MarkerClusterer.BATCH_SIZE,this.batchSizeIE_=c.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE,this.clusterClass_=c.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(b,!0),this.setMap(a)}function initNewMap(a,b){function c(a){a.initialLocation=new google.maps.LatLng(0,0),centerMap(a),a.map.setZoom(1)}if(a.map=new google.maps.Map(jQuery(a.mapholder).find(".map:first").get(0),b),navigator.geolocation)navigator.geolocation.getCurrentPosition(function(b){a.initialLocation=new google.maps.LatLng(b.coords.latitude,b.coords.longitude),centerMap(a),a.map.setZoom(a.zoomlevel)},function(){c(a)});else if(google.gears){var d=google.gears.factory.create("beta.geolocation");d.getCurrentPosition(function(b){a.initialLocation=new google.maps.LatLng(b.latitude,b.longitude),centerMap(a),a.map.setZoom(a.zoomlevel)},function(){c(a)})}else c(a)}function initExistingMap(a,b){if(a){if(a.map=new google.maps.Map(jQuery(a.mapholder).find(".map:first").get(0),b),!a.coordinates)return void initNewMap(a,b);var c=/\[([\d\.\-,; ]+)\]/;if(a&&a.coordinates){var d=c.exec(a.coordinates)[1],e=d.split(";");if(c=/^([^\[]*)/,jQuery(a.mapholder).data("displayName",c.exec(a.coordinates)[1]),e.length>1){var f=new Array,g=null;for(eastMostLong=null,northMostLat=null,southMostLat=null,i=0;i<e.length;i++){var h=e[i].split(","),j=new google.maps.LatLng(h[0],h[1]);(eastMostLong>=h[1]||null===eastMostLong)&&(eastMostLong=h[1]),(g<=h[1]||null===g)&&(g=h[1]),(northMostLat>=h[0]||null===northMostLat)&&(northMostLat=h[0]),(southMostLat<=h[0]||null===southMostLat)&&(southMostLat=h[0]);var k=new google.maps.Marker({position:j,map:a.map,zIndex:i});f.push(k),a.markers=f}var l=new google.maps.LatLngBounds(new google.maps.LatLng(southMostLat,g),new google.maps.LatLng(northMostLat,eastMostLong));a.map.fitBounds(l),jQuery(a.mapholder).find(".mapKMLInput:first").show(),jQuery(a.mapholder).find(".mapCoordInput:first").hide(),jQuery(a.mapholder).find(".map:first").show()}else{var m=e[0].split(",");placeMarker(a,m[0],m[1])}}}}function placeMarker(a,b,c){removeMarker(a),a.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c,!0),map:a.map,draggable:!0}),setMarkerEventListeners(a),showMarker(a)}function setMarkerEventListeners(a){google.maps.event.addListener(a.map,"click",function(b){placeMarker(a,b.latLng.lat(),b.latLng.lng())}),a.marker&&(google.maps.event.addListener(a.marker,"click",function(){removeMarker(a),updateCoordinates(a)}),google.maps.event.addListener(a.marker,"position_changed",function(){updateCoordinates(a)}),google.maps.event.addListener(a.marker,"dragend",function(){centerMapOnMarker(a)}))}function initMapsApp(a){a.geocoder=new google.maps.Geocoder,mapsInitializeEvents(a)}function showMarker(a){a.marker&&a.marker.setMap(a.map),centerMapOnMarker(a),updateCoordinates(a)}function updateCoordinates(a){a.marker?setCoordinates(a,a.marker.getPosition().lat(),a.marker.getPosition().lng()):setCoordinates(a,null,null)}function centerMapOnMarker(a){centerMapLocation(a,a.marker.position)}function centerMap(a){centerMapLocation(a,a.initialLocation)}function centerMapLocation(a,b){a.map&&a.map.setCenter(b)}function checkValidCoordinatesString(a){a=a.replace(/ /g,"");var b=new RegExp("[-]?[0-9]{1,2}[.]{0,1}[0-9]{0,6}[,][-]?[0-9]{1,3}[.]{0,1}[0-9]{0,6}");if(b.test(a)){a=a.split(",");var c=parseFloat(a[0]),d=parseFloat(a[1]);return Math.abs(c)<=90&&Math.abs(d)<=180?new google.maps.LatLng(c,d):null}return null}function searchGoogleMaps(a,b){if(clearSuggestions(a),a.geocoder&&b.length>1&&b!=a.searchDefaultText){var c=checkValidCoordinatesString(b);if(c){var d='<div class="mapSuggestLink">'+c.lat()+", "+c.lng()+"<span>"+c.lat()+"</span><span>"+c.lng()+"</span></div>";jQuery(a.mapholder).find(".mapSearchSuggest:first").append(d),a.geocoder.geocode({latLng:c},function(b,c){b.length>0?handleResponse(a,b,c):doMakeUp(a)})}else a.geocoder.geocode({address:formatSearchText(b)},function(b,c){handleResponse(a,b,c)})}else clearSuggestions(a)}function handleResponse(a,b,c){if(c==google.maps.GeocoderStatus.OK){for(var d="",e=0;e<b.length;e++){var f=b[e].geometry.location.lat(),g=b[e].geometry.location.lng(),h=b[e].formatted_address;d+='<div class="mapSuggestLink">'+h+"<span>"+f+"</span><span>"+g+"</span></div>"}jQuery(a.mapholder).find(".mapSearchSuggest:first").append(d),doMakeUp(a)}else clearSuggestions(a)}function findSelectedSuggest(a){var b=a.mapholder.find(".mapSearchSuggest:first").find(".selected:first");if(b){var c=jQuery(b).find("span:first").text(),d=jQuery(b).find("span:last").text();jQuery(b).find("span").remove(),jQuery(a.mapholder).data("displayName",b.text()),placeMarker(a,c,d),jQuery(a.mapholder).find(".mapSearchText:first").val(b.text())}clearSuggestions(a)}function doMakeUp(a){jQuery(a.mapholder).find(".mapSearchSuggest:first").css("display","block"),jQuery(a.mapholder).find(".mapSuggestLink").find("span").css({display:"none"}),jQuery(a.mapholder).find(".mapSuggestLink").css({padding:"3px 5px",cursor:"pointer"})}function mapsInitializeEvents(a){jQuery(a.mapholder).find(".mapSearchText:first").blur(function(){setDefaultText(this,a.searchDefaultText)}),jQuery(a.mapholder).find(".mapSearchText:first").click(function(){clearDefaultText(this,a.searchDefaultText)}),jQuery(a.mapholder).find(".mapSearchSuggest:first").css({"background-color":"#FFF",border:"1px solid #000","font-size":"0.85em",position:"absolute","z-index":"1",display:"none"}),jQuery(a.mapholder).find(".mapSuggestLink").live("click mouseover mouseout",function(b){"click"==b.type?(jQuery(this).attr("class",".mapSuggestLink selected"),findSelectedSuggest(a)):"mouseover"==b.type?setSelectedSuggest(a,jQuery("#mapSearchSuggest .mapSuggestLink").index(jQuery(this))):setSelectedSuggest(a,-1)}),jQuery(a.mapholder).find(".mapSearchText:first").keydown(function(b){var c=b.keyCode||b.which,d={tab:9,enter:13,up:38,down:40};switch(c){case d.tab:findSelectedSuggest(a);break;case d.enter:findSelectedSuggest(a);break;case d.up:navigateSuggestions(a,"up");break;case d.down:navigateSuggestions(a,"down");break;default:jQuery(this).stopTime("suggest").oneTime(1e3,"suggest",function(){searchGoogleMaps(a,jQuery(this).val())})}}),jQuery(a.mapholder).find(".mapCoordInput:first").find("a:first").click(function(b){b.preventDefault(),jQuery(this).parent().hide(200,function(){jQuery(a.mapholder).find(".mapKMLInput:first").slideDown(200)}),jQuery(a.mapholder).find(".map:first").hide(200),cleanMap(a)}),jQuery(a.mapholder).find(".mapKMLInput:first").find("a:first").click(function(b){b.preventDefault(),jQuery(this).parent().hide(200,function(){jQuery(a.mapholder).find(".mapCoordInput:first .mapSearchBox").slideDown(200),jQuery(a.mapholder).find(".map:first").slideDown(200)}),cleanMap(a)})}function setCoordinates(a,b,c){if(b&&c){var d=jQuery(a.mapholder).data("displayName");d||(d=""),jQuery(a.mapholder).find(".coordinates:first").val(d+" ["+b+", "+c+"]")}else jQuery(a.mapholder).find(".coordinates:first").val("")}function formatSearchText(a){var b=a;return b=b.replace(/ /g,"+"),b=b.replace(/\n/g,""),b=b.replace(/\r/g,"")}function navigateSuggestions(a,b){var c=jQuery(a.mapholder).find(".mapSearchSuggest:first").children().size();"down"==b&&a.selectionIndex<c-1?a.selectionIndex++:"up"==b&&-1==a.selectionIndex?a.selectionIndex=c-1:"up"==b&&a.selectionIndex>-1?a.selectionIndex--:a.selectionIndex=-1,setSelectedSuggest(a,a.selectionIndex)}function setSelectedSuggest(a,b){jQuery(a.mapholder).find(".mapSuggestLink").css({"background-color":"transparent"}),jQuery(a.mapholder).find(".mapSuggestLink").removeClass("selected");var c=jQuery(a.mapholder).find(".mapSearchSuggest:first").children().size();c>b&&b>-1&&(jQuery(a.mapholder).find(".mapSuggestLink").eq(b).css({"background-color":"#D5DDF3"}),jQuery(a.mapholder).find(".mapSuggestLink").eq(b).addClass("selected"))}function clearSuggestions(a){jQuery(a.mapholder).find(".mapSearchSuggest:first").css("display","none"),jQuery(a.mapholder).find(".mapSearchSuggest:first").empty()}function clearDefaultText(a,b){a.value==b&&(a.value="")}function setDefaultText(a,b){""==a.value&&(a.value=b)}function cleanMap(a){for(removeMarker(a),i=0;i<a.markers.length;i++)a.markers[i].setMap(null)}function removeMarker(a){a.marker&&a.marker.setMap(null),a.marker=null}GeolocationMarker.prototype=new google.maps.MVCObject,GeolocationMarker.prototype.set=function(a,b){if(/^(?:position|accuracy)$/i.test(a))throw"'"+a+"' is a read-only property.";/map/i.test(a)?this.setMap(b):google.maps.MVCObject.prototype.set.apply(this,arguments)},GeolocationMarker.prototype.marker_=null,GeolocationMarker.prototype.circle_=null,GeolocationMarker.prototype.getMap=function(){return this.map},GeolocationMarker.prototype.getPositionOptions=function(){return this.get("position_options")},GeolocationMarker.prototype.setPositionOptions=function(a){this.set("position_options",a)},GeolocationMarker.prototype.getPosition=function(){return this.position},GeolocationMarker.prototype.getBounds=function(){return this.position?this.circle_.getBounds():null},GeolocationMarker.prototype.getAccuracy=function(){return this.accuracy},GeolocationMarker.prototype.getMinimumAccuracy=function(){return this.get("minimum_accuracy")},GeolocationMarker.prototype.setMinimumAccuracy=function(a){this.set("minimum_accuracy",a)},GeolocationMarker.prototype.watchId_=-1,GeolocationMarker.prototype.setMap=function(a){this.map=a,this.notify("map"),a?this.watchPosition_():(this.marker_.unbind("position"),this.circle_.unbind("center"),this.circle_.unbind("radius"),this.accuracy=null,this.position=null,navigator.geolocation.clearWatch(this.watchId_),this.watchId_=-1,this.marker_.setMap(a))},GeolocationMarker.prototype.setMarkerOptions=function(a){this.marker_.setOptions(this.copyOptions_({},a))},GeolocationMarker.prototype.setCircleOptions=function(a){this.circle_.setOptions(this.copyOptions_({},a))},GeolocationMarker.prototype.updatePosition_=function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),c=null==this.marker_.getMap();if(c){if(null!=this.getMinimumAccuracy()&&a.coords.accuracy>this.getMinimumAccuracy())return;this.marker_.setMap(this.map),this.marker_.bindTo("position",this),this.circle_.bindTo("center",this,"position"),this.circle_.bindTo("radius",this,"accuracy")}this.accuracy!=a.coords.accuracy&&google.maps.MVCObject.prototype.set.call(this,"accuracy",a.coords.accuracy),(c||null==this.position||!this.position.equals(b))&&google.maps.MVCObject.prototype.set.call(this,"position",b)},GeolocationMarker.prototype.watchPosition_=function(){var a=this;navigator.geolocation&&(this.watchId_=navigator.geolocation.watchPosition(function(b){a.updatePosition_(b)},function(b){google.maps.event.trigger(a,"geolocation_error",b)},this.getPositionOptions()))},GeolocationMarker.prototype.copyOptions_=function(a,b){for(var c in b)GeolocationMarker.DISALLOWED_OPTIONS[c]!==!0&&(a[c]=b[c]);return a},GeolocationMarker.DISALLOWED_OPTIONS={map:!0,position:!0,radius:!0},ClusterIcon.prototype.onAdd=function(){var a,b,c=this;this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),google.maps.event.addListener(this.getMap(),"bounds_changed",function(){b=a}),google.maps.event.addDomListener(this.div_,"mousedown",function(){a=!0,b=!1}),google.maps.event.addDomListener(this.div_,"click",function(d){if(a=!1,!b){var e,f,g=c.cluster_.getMarkerClusterer();google.maps.event.trigger(g,"click",c.cluster_),google.maps.event.trigger(g,"clusterclick",c.cluster_),g.getZoomOnClick()&&(f=g.getMaxZoom(),e=c.cluster_.getBounds(),g.getMap().fitBounds(e),setTimeout(function(){g.getMap().fitBounds(e),null!==f&&g.getMap().getZoom()>f&&g.getMap().setZoom(f+1)},100)),d.cancelBubble=!0,d.stopPropagation&&d.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){var a=c.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"mouseover",c.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){var a=c.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"mouseout",c.cluster_)})},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px",this.div_.style.left=a.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+"</div>":this.sums_.text,this.div_.title="undefined"==typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.useStyle=function(a){this.sums_=a;var b=Math.max(0,a.index-1);b=Math.min(this.styles_.length-1,b);var c=this.styles_[b];this.url_=c.url,this.height_=c.height,this.width_=c.width,this.anchor_=c.anchor,this.anchorIcon_=c.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=c.textColor||"black",this.textSize_=c.textSize||11,this.textDecoration_=c.textDecoration||"none",this.fontWeight_=c.fontWeight||"bold",this.fontStyle_=c.fontStyle||"normal",this.fontFamily_=c.fontFamily||"Arial,sans-serif",this.backgroundPosition_=c.backgroundPosition||"0 0"},ClusterIcon.prototype.setCenter=function(a){this.center_=a},ClusterIcon.prototype.createCss=function(a){var b=[];return this.cluster_.printable_||(b.push("background-image:url("+this.url_+");"),b.push("background-position:"+this.backgroundPosition_+";")),"object"==typeof this.anchor_?(b.push("number"==typeof this.anchor_[0]&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?"height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;":"height:"+this.height_+"px; line-height:"+this.height_+"px;"),b.push("number"==typeof this.anchor_[1]&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?"width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;":"width:"+this.width_+"px; text-align:center;")):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;"),b.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+"; text-decoration:"+this.textDecoration_+";"),b.join("")},ClusterIcon.prototype.getPosFromLatLng_=function(a){var b=this.getProjection().fromLatLngToDivPixel(a);return b.x-=this.anchorIcon_[1],b.y-=this.anchorIcon_[0],b},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var a,b=new google.maps.LatLngBounds(this.center_,this.center_),c=this.getMarkers();for(a=0;a<c.length;a++)b.extend(c[a].getPosition());return b},Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},Cluster.prototype.addMarker=function(a){var b,c,d;if(this.isMarkerAlreadyAdded_(a))return!1;if(this.center_){if(this.averageCenter_){var e=this.markers_.length+1,f=(this.center_.lat()*(e-1)+a.getPosition().lat())/e,g=(this.center_.lng()*(e-1)+a.getPosition().lng())/e;this.center_=new google.maps.LatLng(f,g),this.calculateBounds_()}}else this.center_=a.getPosition(),this.calculateBounds_();if(a.isAdded=!0,this.markers_.push(a),c=this.markers_.length,d=this.markerClusterer_.getMaxZoom(),null!==d&&this.map_.getZoom()>d)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c<this.minClusterSize_)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c===this.minClusterSize_)for(b=0;c>b;b++)this.markers_[b].setMap(null);else a.setMap(null);return this.updateIcon_(),!0},Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())},Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)},Cluster.prototype.updateIcon_=function(){var a=this.markers_.length,b=this.markerClusterer_.getMaxZoom();if(null!==b&&this.map_.getZoom()>b)return void this.clusterIcon_.hide();if(a<this.minClusterSize_)return void this.clusterIcon_.hide();var c=this.markerClusterer_.getStyles().length,d=this.markerClusterer_.getCalculator()(this.markers_,c);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(d),this.clusterIcon_.show()},Cluster.prototype.isMarkerAlreadyAdded_=function(a){var b;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(a);for(b=0;b<this.markers_.length;b++)if(a===this.markers_[b])return!0;return!1},MarkerClusterer.prototype.onAdd=function(){var a=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){a.resetViewport_(!1),(this.getZoom()===(this.get("minZoom")||0)||this.getZoom()===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){a.redraw_()})]},MarkerClusterer.prototype.onRemove=function(){var a;for(a=0;a<this.markers_.length;a++)this.markers_[a].getMap()!==this.activeMap_&&this.markers_[a].setMap(this.activeMap_);for(a=0;a<this.clusters_.length;a++)this.clusters_[a].remove();for(this.clusters_=[],a=0;a<this.listeners_.length;a++)google.maps.event.removeListener(this.listeners_[a]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){var a,b;if(!(this.styles_.length>0))for(a=0;a<this.imageSizes_.length;a++)b=this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:b,width:b})},MarkerClusterer.prototype.fitMapToMarkers=function(){var a,b=this.getMarkers(),c=new google.maps.LatLngBounds;for(a=0;a<b.length;a++)c.extend(b[a].getPosition());this.getMap().fitBounds(c)},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a},MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.setStyles=function(a){this.styles_=a},MarkerClusterer.prototype.getTitle=function(){return this.title_},MarkerClusterer.prototype.setTitle=function(a){this.title_=a},MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a},MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a},MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a},MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_},MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a},MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_},MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a},MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_},MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a},MarkerClusterer.prototype.getPrintable=function(){return this.printable_},MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a},MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a},MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_},MarkerClusterer.prototype.setClusterClass=function(a){this.clusterClass_=a},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.getClusters=function(){return this.clusters_},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a),b||this.redraw_()},MarkerClusterer.prototype.addMarkers=function(a,b){var c;for(c=0;c<a.length;c++)this.pushMarkerTo_(a[c]);b||this.redraw_()},MarkerClusterer.prototype.pushMarkerTo_=function(a){if(a.getDraggable()){var b=this;google.maps.event.addListener(a,"dragend",function(){b.ready_&&(this.isAdded=!1,b.repaint())})}a.isAdded=!1,this.markers_.push(a)},MarkerClusterer.prototype.removeMarker=function(a,b){var c=this.removeMarker_(a);return!b&&c&&this.repaint(),c},MarkerClusterer.prototype.removeMarkers=function(a,b){var c,d,e=!1;for(c=0;c<a.length;c++)d=this.removeMarker_(a[c]),e=e||d;return!b&&e&&this.repaint(),e},MarkerClusterer.prototype.removeMarker_=function(a){var b,c=-1;if(this.markers_.indexOf)c=this.markers_.indexOf(a);else for(b=0;b<this.markers_.length;b++)if(a===this.markers_[b]){c=b;break}return-1===c?!1:(a.setMap(null),this.markers_.splice(c,1),!0)},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){var b;for(b=0;b<a.length;b++)a[b].remove()},0)},MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),e=b.fromLatLngToDivPixel(c);e.x+=this.gridSize_,e.y-=this.gridSize_;var f=b.fromLatLngToDivPixel(d);f.x-=this.gridSize_,f.y+=this.gridSize_;var g=b.fromDivPixelToLatLng(e),h=b.fromDivPixelToLatLng(f);return a.extend(g),a.extend(h),a},MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)},MarkerClusterer.prototype.resetViewport_=function(a){var b,c;for(b=0;b<this.clusters_.length;b++)this.clusters_[b].remove();for(this.clusters_=[],b=0;b<this.markers_.length;b++)c=this.markers_[b],c.isAdded=!1,a&&c.setMap(null)},MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())},MarkerClusterer.prototype.addToClosestCluster_=function(a){var b,c,d,e,f=4e4,g=null;for(b=0;b<this.clusters_.length;b++)d=this.clusters_[b],e=d.getCenter(),e&&(c=this.distanceBetweenPoints_(e,a.getPosition()),f>c&&(f=c,g=d));g&&g.isMarkerInClusterBounds(a)?g.addMarker(a):(d=new Cluster(this),d.addMarker(a),this.clusters_.push(d))},MarkerClusterer.prototype.createClusters_=function(a){var b,c,d,e=this;if(this.ready_){0===a&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!=typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),d=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));var f=this.getExtendedBounds(d),g=Math.min(a+this.batchSize_,this.markers_.length);for(b=a;g>b;b++)c=this.markers_[b],!c.isAdded&&this.isMarkerInBounds_(c,f)&&(!this.ignoreHidden_||this.ignoreHidden_&&c.getVisible())&&this.addToClosestCluster_(c);g<this.markers_.length?this.timerRefStatic=setTimeout(function(){e.createClusters_(g)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}},MarkerClusterer.prototype.extend=function(a,b){return function(a){var b;for(b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])},MarkerClusterer.CALCULATOR=function(a,b){for(var c=0,d="",e=a.length.toString(),f=e;0!==f;)f=parseInt(f/10,10),c++;return c=Math.min(c,b),{text:e,index:c,title:d}},MarkerClusterer.BATCH_SIZE=2e3,MarkerClusterer.BATCH_SIZE_IE=500,MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m",MarkerClusterer.IMAGE_EXTENSION="png",MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90],jQuery.fn.extend({everyTime:function(a,b,c,d){return this.each(function(){jQuery.timer.add(this,a,b,c,d)})},oneTime:function(a,b,c){return this.each(function(){jQuery.timer.add(this,a,b,c,1)})},stopTime:function(a,b){return this.each(function(){jQuery.timer.remove(this,a,b)})}}),jQuery.extend({timer:{global:[],guid:1,dataKey:"jQuery.timer",regex:/^([0-9]+(?:\.[0-9]*)?)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(a){if(void 0==a||null==a)return null;var b=this.regex.exec(jQuery.trim(a.toString()));if(b[2]){var c=parseFloat(b[1]),d=this.powers[b[2]]||1;return c*d}return a},add:function(a,b,c,d,e){var f=0;if(jQuery.isFunction(c)&&(e||(e=d),d=c,c=b),b=jQuery.timer.timeParse(b),!("number"!=typeof b||isNaN(b)||0>b)){("number"!=typeof e||isNaN(e)||0>e)&&(e=0),e=e||0;var g=jQuery.data(a,this.dataKey)||jQuery.data(a,this.dataKey,{});g[c]||(g[c]={}),d.timerID=d.timerID||this.guid++;var h=function(){(++f>e&&0!==e||d.call(a,f)===!1)&&jQuery.timer.remove(a,c,d)};h.timerID=d.timerID,g[c][d.timerID]||(g[c][d.timerID]=window.setInterval(h,b)),this.global.push(a)}},remove:function(a,b,c){var d,e=jQuery.data(a,this.dataKey);if(e){if(b){if(e[b]){if(c)c.timerID&&(window.clearInterval(e[b][c.timerID]),delete e[b][c.timerID]);else for(var c in e[b])window.clearInterval(e[b][c]),delete e[b][c];for(d in e[b])break;d||(d=null,delete e[b])}}else for(b in e)this.remove(a,b,c);for(d in e)break;d||jQuery.removeData(a,this.dataKey)}}}}),jQuery(window).bind("unload",function(){jQuery.each(jQuery.timer.global,function(a,b){jQuery.timer.remove(b)})});