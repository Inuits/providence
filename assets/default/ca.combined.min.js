/*! CollectiveAccess Providence 2015-03-10 */
var caUI=caUI||{};!function(){caUI.initBookReader=function(a){var b=jQuery.extend({containerID:"BookReader",bookreader:null,docURL:null,width:"100%",height:"100%",page:1,sidebar:!1,editButton:"Edit",downloadButton:"Download",closeButton:"Close",sectionsAreSelectable:!1,selectionRecordURL:null},a);return b.bookreader=DV.load(b.docURL,{container:"#"+b.containerID,width:b.width,height:b.height,sidebar:b.sidebar,page:b.page,editButton:b.editButton,downloadButton:b.downloadButton,closeButton:b.closeButton,sectionsAreSelectable:b.sectionsAreSelectable,selectionRecordURL:b.selectionRecordURL,search:!0,text:!1}),b}}(jQuery);var caUI=caUI||{};!function(){caUI.initBrowsePanel=function(a){var b=jQuery.extend({facetUrl:"",addCriteriaUrl:"",panelCSSClass:"browseSelectPanel",panelID:"splashBrowsePanel",panelContentID:"splashBrowsePanelContent",facetSelectID:"browseFacetSelect",useExpose:!0,useStaticDiv:!1,isChanging:!1,browseID:null,singleFacetValues:{},exposeBackgroundColor:"#000000",exposeBackgroundOpacity:.5,panelTransitionSpeed:200},a);return b.showBrowsePanel=function(a,c,d,e,f,g,h){if(b.singleFacetValues[a])return document.location=b.addCriteriaUrl+"/facet/"+a+"/id/"+b.singleFacetValues[a],!0;if(b.isChanging=!0,a){var i=h&&h.panelContentID?h.panelContentID:b.panelContentID;b.useStaticDiv||(jQuery("#"+b.panelID).fadeIn(b.panelTransitionSpeed,function(){b.isChanging=!1}),b.useExpose&&jQuery("#"+b.panelID).expose({api:!0,color:b.exposeBackgroundColor,opacity:b.exposeBackgroundOpacity,zIndex:99999}).load()),d||(d="");var h={facet:a,modify:c?1:"",id:d,grouping:e,clear:f?1:0};b.browseID&&(h.browse_id=b.browseID),g&&(h.target=g),jQuery("#"+i).load(b.facetUrl,h)}},b.hideBrowsePanel=function(){b.isChanging=!0;var c=a&&a.panelContentID?a.panelContentID:b.panelContentID;b.useStaticDiv||(jQuery("#"+b.panelID).fadeOut(b.panelTransitionSpeed,function(){b.isChanging=!1}),b.useExpose&&jQuery.mask.close()),jQuery("#"+c).empty()},b.browsePanelIsVisible=function(){return jQuery("#"+b.panelID+":visible").length>0?!0:!1},jQuery(document).ready(function(){jQuery("#"+b.facetSelectID).change(function(){b.showBrowsePanel(jQuery("#"+b.facetSelectID).val())}).click(function(){jQuery("#"+b.facetSelectID).attr("selectedIndex",0)}),jQuery(document).click(function(a){var c=jQuery(a.target).parents().map(function(){return this.id}).get();!b.isChanging&&b.browsePanelIsVisible()&&-1==jQuery.inArray(b.panelID,c)&&b.hideBrowsePanel()}),jQuery(document).keyup(function(a){27==a.keyCode&&!b.isChanging&&b.browsePanelIsVisible()&&b.hideBrowsePanel()})}),b}}(jQuery);var caUI=caUI||{};!function(){caUI.bundlelisteditor=function(a){var b=jQuery.extend({availableListID:"bundleDisplayEditorAvailableList",toDisplayListID:"bundleDisplayEditorToDisplayList",displayItemClass:"bundleDisplayEditorPlacement",displayListClass:"bundleDisplayEditorPlacementList",availableDisplayList:null,initialDisplayList:null,initialDisplayListOrder:null,displayBundleListID:null,settingsIcon:null},a);return b.initDisplayList=function(){if(b.initialDisplayList){var a="",c={};jQuery.each(b.initialDisplayListOrder,function(d,e){a+=b._formatForDisplay(b.initialDisplayList[e]),c[e.bundle]=!0}),jQuery("#"+b.toDisplayListID).html(a).find("input:checked").change(),a="",jQuery.each(b.availableDisplayList,function(c,d){a+=b._formatForDisplay(d)}),jQuery("#"+b.availableListID).html(a),b._makeDisplayListsSortable(),b._updateBundleListFormElement()}},b._makeDisplayListsSortable=function(){jQuery("#"+b.availableListID).sortable({opacity:.7,revert:.2,scroll:!0,connectWith:"#"+b.toDisplayListID,update:function(){b._updateBundleListFormElement()}}),jQuery("#"+b.toDisplayListID).sortable({opacity:.7,revert:.2,scroll:!0,connectWith:"#"+b.availableListID,update:function(){b._updateBundleListFormElement()}})},b._formatForDisplay=function(a){var c,d=a.display,e=a.bundle,f=a.placement_id,g="",h=e;return f?(g=b.initialDisplayList[f]?b.initialDisplayList[f].settingsForm:"",h=h+"_"+f):(g=b.availableDisplayList[e]?b.availableDisplayList[e].settingsForm:"",h+="_0"),c="<div id='displayElement_"+h+"' class='"+b.displayItemClass+"'>",c+=" <div class='bundleDisplayElementSettingsControl'><a href='#' onclick='jQuery(\".elementSettingsUI\").fadeOut(250); jQuery(\"#displayElementSettings_"+h.replace(/\./g,"\\\\.")+"\").fadeIn(250); return false; '>"+b.settingsIcon+"</a></div>",c+="<div style='width:75%'>"+d+" </div>",c+="</div>\n",c+="<div id='displayElementSettings_"+h+"' class='elementSettingsUI' style='display: none;'>"+d+g+"<a href='#' onclick='jQuery(\"#displayElementSettings_"+h.replace(/\./g,"\\\\.")+"\").fadeOut(250); return false; '>"+b.settingsIcon+"</a></div>"},b._updateBundleListFormElement=function(){var a=[];jQuery.each(jQuery("#"+b.toDisplayListID+" div."+b.displayItemClass),function(b,c){a.push(jQuery(c).attr("id").replace("displayElement_",""))}),jQuery("#"+b.displayBundleListID).val(a.join(";")),jQuery("#"+b.availableListID+" ."+b.displayItemClass+" .bundleDisplayElementSettingsControl").hide(0),jQuery("#"+b.availableListID+" input").attr("disabled",!0),jQuery("#"+b.toDisplayListID+" ."+b.displayItemClass+" .bundleDisplayElementSettingsControl").show(0),jQuery("#"+b.toDisplayListID+" input").attr("disabled",!1)},b.initDisplayList(),b}}(jQuery);var caUI=caUI||{},caBundleUpdateManager=null;!function(){caUI.initBundleUpdateManager=function(a){var b=jQuery.extend({byBundle:{},byID:{},byPlacementID:{},inspectorID:"widgets",key:null,id:null,url:null,screen:null},a);return b.registerBundle=function(a,c,d){b.byID[a]=b.byPlacementID[d]={id:a,bundle:c,placement_id:d},b.byBundle[c]||(b.byBundle[c]=[]),b.byBundle[c].push(b.byID[a])},b.registerBundles=function(a){var c;for(c in a)b.registerBundle(a[c].id,a[c].bundle,a[c].placement_id)},b.reloadBundle=function(a){var c=b.byBundle[a];c&&jQuery.each(c,function(a,c){var d=b.url+"/"+b.key+"/"+b.id+"/bundle/"+c.bundle+"/placement_id/"+c.placement_id;jQuery("#"+c.id).load(d)})},b.reloadInspector=function(){var a=b.url+"/"+b.key+"/"+b.id+"/bundle/__inspector__";jQuery("#"+b.inspectorID).load(a)},b}}(jQuery);var caUI=caUI||{};!function(){caUI.initBundleVisibilityManager=function(a){var b=jQuery.extend({bundles:[],cookieJar:jQuery.cookieJar("caBundleVisibility"),bundleStates:{},bundleDictionaryStates:{}},a);return b.registerBundle=function(a){b.bundles.push(a),b.bundleStates[a]="closed"==b.cookieJar.get(a)?"closed":"open",b.bundleDictionaryStates[a]="open"==b.cookieJar.get(a+"DictionaryEntry")?"open":"closed","closed"==b.bundleStates[a]?b.close(a,!0):b.open(a,!0),"closed"==b.bundleDictionaryStates[a]?b.closeDictionaryEntry(a,!0):b.openDictionaryEntry(a,!0)},b.setAll=function(){jQuery.each(b.bundles,function(a,c){"closed"==b.bundleStates[c]?jQuery("#"+c).hide():jQuery("#"+c).show()})},b.toggle=function(a){return"closed"==b.bundleStates[a]?b.open(a):b.close(a),!1},b.open=function(a,c){if(void 0===a)jQuery.each(b.bundles,function(a,c){b.open(c)});else{var d=a.replace(/[0-9]+\_rel/g,"");jQuery("#"+a).slideDown(c?0:250),jQuery("#"+d+"_BundleContentPreview").hide(),jQuery("#"+a+"DictionaryEntry").length&&"open"==b.bundleDictionaryStates[a]&&jQuery("#"+a+"DictionaryEntry").slideDown(c?0:250),b.bundleStates[a]="open",b.cookieJar.set(a,"open"),jQuery("#"+a+"VisToggleButton").rotate(c?{angle:180}:{duration:500,angle:0,animateTo:180})}return!1},b.close=function(a,c){if(void 0===a)jQuery.each(b.bundles,function(a,c){b.close(c)});else{var d=a.replace(/[0-9]+\_rel/g,"");jQuery("#"+a).slideUp(c?0:250),jQuery("#"+d+"_BundleContentPreview").show(),jQuery("#"+a+"DictionaryEntry").length&&"open"==b.bundleDictionaryStates[a]&&jQuery("#"+a+"DictionaryEntry").slideUp(c?0:250),b.bundleStates[a]="closed",b.cookieJar.set(a,"closed"),jQuery("#"+a+"VisToggleButton").rotate(c?{angle:0}:{duration:500,angle:180,animateTo:0})}return!1},b.toggleDictionaryEntry=function(a){return"closed"==b.bundleDictionaryStates[a]?b.openDictionaryEntry(a):b.closeDictionaryEntry(a),!1},b.openDictionaryEntry=function(a,c){if(void 0===a)jQuery.each(b.bundles,function(a,c){b.openDictionaryEntry(c)});else{if(!jQuery("#"+a+"DictionaryEntry").length)return!1;jQuery("#"+a+"DictionaryEntry").slideDown(c?0:250),b.bundleDictionaryStates[a]="open",b.cookieJar.set(a+"DictionaryEntry","open"),"closed"==b.bundleStates[a]&&b.open(a),c?jQuery("#"+a+"MetadataDictionaryToggleButton").css("opacity",1):jQuery("#"+a+"MetadataDictionaryToggleButton").animate({duration:500,opacity:1,animateTo:.4})}return!1},b.closeDictionaryEntry=function(a,c){if(void 0===a)jQuery.each(b.bundles,function(a,c){b.closeDictionaryEntry(c)});else{if(!jQuery("#"+a+"DictionaryEntry").length)return!1;jQuery("#"+a+"DictionaryEntry").slideUp(c?0:250),b.bundleDictionaryStates[a]="closed",b.cookieJar.set(a+"DictionaryEntry","closed"),c?jQuery("#"+a+"MetadataDictionaryToggleButton").css("opacity",.4):jQuery("#"+a+"MetadataDictionaryToggleButton").animate({duration:500,opacity:.4,animateTo:1})}return!1},b},caBundleVisibilityManager=caUI.initBundleVisibilityManager()}(jQuery);var caUI=caUI||{};!function(){caUI.initChecklistBundle=function(a,b){var c=jQuery.extend({container:a,templateValues:[],initialValues:{},errors:{},itemID:"",fieldNamePrefix:"",templateClassName:"caItemTemplate",itemListClassName:"caItemList",localeClassName:"labelLocale",counter:0,minRepeats:0,maxRepeats:65535,defaultValues:{},readonly:0,bundlePreview:""},b);return c.showUnsavedChangesWarning=function(a){"function"==typeof caUI.utils.showUnsavedChangesWarning&&(void 0===a&&(a=!0),caUI.utils.showUnsavedChangesWarning(a))},c.setupBundle=function(b,c){var d={};d.n=b;var e=[];if(this.errors&&this.errors[b]){var f;for(f=0;f<this.errors[b].length;f++)e.push(this.errors[b][f].errorDescription)}d.error=e.join("<br/>"),d.fieldNamePrefix=this.fieldNamePrefix,b||jQuery.each(this.defaultValues,function(a,b){b&&!c[a]&&(c[a]=b)});var g=jQuery(this.container+" textarea."+this.templateClassName).template(d);jQuery(this.container+" ."+this.itemListClassName).append(g);var h=this;jQuery(a+" input[type=checkbox]").click(function(){var a=!h.checkMaxMin();a?jQuery(this).prop("checked",!jQuery(this).prop("checked")):(h.showUnsavedChangesWarning(!0),jQuery(this).prop("checked")?jQuery(jQuery(this).attr("id")+"_delete").remove():h.deleteValue(jQuery(this).attr("id")))}),jQuery(a+" input[type=checkbox]").each(function(a,b){jQuery(b).attr("id",h.fieldNamePrefix+h.templateValues[0]+"_new_"+a),jQuery(b).attr("name",h.fieldNamePrefix+h.templateValues[0]+"_new_"+a)}),jQuery.each(c,function(a,b){jQuery(h.container+" input[value="+b[h.templateValues[0]]+"]").prop("checked",!0).attr("id",h.fieldNamePrefix+h.templateValues[0]+"_"+a).attr("name",h.fieldNamePrefix+h.templateValues[0]+"_"+a)}),this.readonly&&(jQuery(this.container+" input").prop("disabled",!0),jQuery(this.container+" select").prop("disabled",!0)),this.bundlePreview&&this.bundlePreview.length>0&&jQuery("#"+this.fieldNamePrefix+"BundleContentPreview").text(this.bundlePreview)},c.deleteValue=function(a){if(-1==a.indexOf("_new_")){var b,c=new RegExp("([A-Za-z0-9_-]+)_([0-9]+)_([0-9]+)_([0-9]+)","g");(b=c.exec(a))?jQuery(this.container).append("<input type='hidden' name='"+b[1]+"_"+b[2]+"_"+b[4]+"_delete' value='1'/>"):(c=new RegExp("([A-Za-z0-9_-]+)_([0-9]+)","g"),(b=c.exec(a))&&jQuery(this.container).append("<input type='hidden' name='"+b[1]+"_"+b[2]+"_delete' value='1'/>"))}return this},c.checkMaxMin=function(){var a=jQuery(c.container+" input:checked").length;return a<c.minRepeats||a>c.maxRepeats?!1:!0},c.setupBundle("checklist",c.initialValues,!0),c}}(jQuery);var caUI=caUI||{};!function(){caUI.initDashboard=function(a){var b=jQuery.extend({reorderURL:null,dashboardClass:"dashboard",landingClass:"dashboardLanding",columnClass:"column",widgetClass:"portlet",widgetRemoveClass:"dashboardRemoveWidget",widgetSettingsClass:"dashboardWidgetSettingsButton",addID:"dashboardAddWidget",editID:"dashboardEditWidget",doneEditingID:"dashboardDoneEditingButton",clearID:"dashboardClearButton",welcomeMessageID:"dashboard_welcome_message",editMessageID:"dashboard_edit_message"},a);return jQuery(document).ready(function(){jQuery("."+b.columnClass).sortable({connectWith:"."+b.columnClass,stop:function(){jQuery.getJSON(b.reorderURL,{sort_column1:jQuery("#dashboard_column_1").sortable("toArray").join(";"),sort_column2:jQuery("#dashboard_column_2").sortable("toArray").join(";")},function(a){"ok"!=a.status&&alert("Error: "+a.errors.join(";")),b.refreshDashboard(!0)})}}),jQuery("."+b.columnClass).disableSelection(),jQuery("."+b.landingClass).disableSelection();var a=0,c=jQuery.cookieJar("caCookieJar");a=c.get("caDashboardEdit"),null==a&&(a=0),a=0==a?0:1,b.editDashboard(a,!0)}),b.refreshDashboard=function(a){var c=jQuery.cookieJar("caCookieJar"),d=!1;jQuery.each(jQuery("."+b.columnClass),function(a,e){1==parseInt(c.get("caDashboardEdit"))?jQuery("#"+e.id+" ."+b.landingClass).css("display",0==jQuery("#"+e.id+" .portlet").length?"block":"none").css("height","100px"):jQuery("#"+e.id+" ."+b.landingClass).css("display","none"),jQuery("#"+e.id+" .portlet").length>0&&(d=!0)}),1==parseInt(c.get("caDashboardEdit"))?(jQuery("#"+b.editMessageID).slideDown(a?0:250),jQuery("#"+b.welcomeMessageID).hide()):(jQuery("#"+b.editMessageID).slideUp(a?0:250),d?jQuery("#"+b.welcomeMessageID).hide():jQuery("#"+b.welcomeMessageID).show()),jQuery.each(jQuery("."+b.columnClass+" div.portlet:not(."+b.landingClass+")"),function(a,b){b.id&&jQuery("#"+b.id).attr("id",b.id+"_tmp")});var e=[];jQuery.each(jQuery("."+b.columnClass+" div.portlet:not(."+b.landingClass+")"),function(a,b){if(b.id){var c=(jQuery("#"+b.id).attr("id"),b.id.split("_"));(col=parseInt(c[1]))||(col=1),(pos=parseInt(c[2]))||(pos=0),c=jQuery("#"+b.id).parent().attr("id").split("_");var d=parseInt(c[2]);e[d]||(e[d]=0),jQuery("#"+b.id).attr("id",c[0]+"_"+d+"_"+e[d]),jQuery("#"+b.id).data("col",d),jQuery("#"+b.id).data("pos",e[d]),e[d]++}})},b.editDashboard=function(a,c){null===a&&(a=0),a=parseInt(a);var d=jQuery.cookieJar("caCookieJar");0!=a?(jQuery("#"+b.addID).show(0),jQuery("#"+b.editID).hide(0),jQuery("#"+b.doneEditingID).show(0),jQuery("#"+b.clearID).show(0),jQuery("."+b.columnClass).sortable("enable"),jQuery("."+b.widgetRemoveClass).show(0),jQuery("."+b.widgetSettingsClass).show(0),d.set("caDashboardEdit",1)):(jQuery("#"+b.addID).hide(0),jQuery("#"+b.editID).show(0),jQuery("#"+b.doneEditingID).hide(0),jQuery("#"+b.clearID).hide(0),jQuery("."+b.columnClass).sortable("disable"),jQuery("."+b.widgetRemoveClass).hide(0),jQuery("."+b.widgetSettingsClass).hide(0),d.set("caDashboardEdit",0)),b.refreshDashboard(c)},b}}(jQuery);var caUI=caUI||{};!function(){caUI.initDirectoryBrowser=function(a,b){var c=jQuery.extend({container:a,levelDataUrl:"",initDataUrl:"",name:b.name?b.name:a.replace(/[^A-Za-z0-9]+/,""),levelWidth:230,browserWidth:500,readOnly:!1,displayFiles:!1,allowFileSelection:!1,initItemID:null,defaultItemID:null,className:"directoryBrowserLevel",classNameSelected:"directoryBrowserLevelSelected",classNameContainer:"directoryBrowserContainer",currentSelectionDisplayID:"",currentSelectionDisplayFormat:"%1",currentSelectionIDID:"",allowSelection:!0,selectOnLoad:!1,onSelection:null,displayCurrentSelectionOnLoad:!0,allowDragAndDropUpload:!0,dragAndDropUploadUrl:null,uploadProgressID:null,uploadProgressBarID:null,uploadProgressStatusID:null,uploadProgressMessage:"%1",indicatorUrl:"",openDirectoryIcon:"",folderIcon:"",fileIcon:"",hasChildrenIndicator:"children",levelLists:[],selectedItemIDs:[],_numOpenLoads:0,_openLoadsForLevel:[],_pageLoadsForLevel:[],_queuedLoadsForLevel:[],maxItemsPerHierarchyLevelPage:100},b);return c.levelDataUrl?(jQuery("#"+c.container).append("<div class='"+c.classNameContainer+"' id='"+c.container+"_scrolling_container'></div>"),c.setUpHierarchy=function(a){return a?(c.levelLists=[],c.selectedItemIDs=[],void jQuery.getJSON(c.initDataUrl,{id:a},function(b){b.length?(c.selectedItemIDs=b.join(";").split(";"),b.unshift("/")):b=["/"];var d=0;jQuery.each(b,function(b,e){c.setUpHierarchyLevel(b,e,1,a),d++}),c.loadHierarchyLevelData(),jQuery("#"+c.container+"_scrolling_container").animate({scrollLeft:d*c.levelWidth},500)})):void c.setUpHierarchyLevel(0,"/",1,null,!0)},c.clearLevelsStartingAt=function(a){for(var b=a;jQuery("#directoryBrowser_"+c.name+"_"+b).length>0;)jQuery("#directoryBrowser_"+c.name+"_"+b).remove(),c.levelLists[b]=void 0,b++},c.setUpHierarchyLevel=function(a,b,d,e,f){if(c._numOpenLoads++,c._openLoadsForLevel[a])return null;c._openLoadsForLevel[a]=!0,c.clearLevelsStartingAt(a),b||(b="/"),d||(d=0);var g="directoryBrowser_"+c.name+"_"+a,h="directoryBrowser_"+c.name+"_list_"+a;d||jQuery("#"+g).remove();var i="<div class='"+c.className+"' style='left:"+c.levelWidth*a+"px;' id='"+g+"'></div>",j="<ul class='"+c.className+"' id='"+h+"'></ul>";jQuery("#"+c.container+"_scrolling_container").append(i),jQuery("#"+g).data("level",a),jQuery("#"+g).data("parent_id",b),jQuery("#"+g).append(j),c.showIndicator(g);var k=jQuery("#"+g).data("level");c._pageLoadsForLevel[k]=[!0],c.queueHierarchyLevelDataLoad(a,b,d,g,h,e,0,f),c.levelLists[a]=g;var l=c.selectedItemIDs.slice(0,a);return c.allowDragAndDropUpload&&c.dragAndDropUploadUrl&&jQuery("#"+g).fileupload({dataType:"json",url:c.dragAndDropUploadUrl+"?path="+encodeURIComponent("/"+l.join("/")),dropZone:jQuery("#"+g),singleFileUploads:!1,done:function(f,g){if(g.result.error)c.uploadProgressStatusID&&(jQuery("#"+c.uploadProgressID).show(250),jQuery("#"+c.uploadProgressStatusID).html(g.result.error),setTimeout(function(){jQuery("#"+c.uploadProgressID).hide(250)},3e3));else{var h=[];g.result.uploadMessage&&h.push(g.result.uploadMessage),g.result.skippedMessage&&h.push(g.result.skippedMessage),jQuery("#"+c.uploadProgressStatusID).html(h.join("; ")),setTimeout(function(){jQuery("#"+c.uploadProgressID).hide(250)},3e3),c.setUpHierarchyLevel(a,b,d,e,!0)}},progressall:function(a,b){if(c.uploadProgressID){"none"==jQuery("#"+c.uploadProgressID).css("display")&&jQuery("#"+c.uploadProgressID).show(250);var d=parseInt(b.loaded/b.total*100,10);if(c.uploadProgressBarID&&jQuery("#"+c.uploadProgressBarID).progressbar("value",d),c.uploadProgressStatusID){var e=c.uploadProgressMessage;jQuery("#"+c.uploadProgressStatusID).html(e.replace("%1",c.formatFilesize(b.loaded)+" ("+d+"%)"))}}}}),i},c.queueHierarchyLevelDataLoad=function(a,b,d,e,f,g,h,i){c._queuedLoadsForLevel[a]||(c._queuedLoadsForLevel[a]=[]),c._queuedLoadsForLevel[a].push({item_id:b,is_init:d,newLevelDivID:e,newLevelListID:f,selected_item_id:g,start:h}),i&&c.loadHierarchyLevelData()},c.loadHierarchyLevelData=function(){for(var a=[],b={},d=!1,e=0;e<c._queuedLoadsForLevel.length;e++)for(var f=0;f<c._queuedLoadsForLevel[e].length;f++){var g=c.selectedItemIDs.slice(0,e>0?e-1:0).join("/"),h=c._queuedLoadsForLevel[e][f].item_id;a.push(g+"/"+("/"!=h?h:"")+":"+c._queuedLoadsForLevel[e][f].start),b[e]={level:e,newLevelDivID:c._queuedLoadsForLevel[e][f].newLevelDivID,newLevelListID:c._queuedLoadsForLevel[e][f].newLevelListID,selected_item_id:c._queuedLoadsForLevel[e][f].selected_item_id,is_init:c._queuedLoadsForLevel[e][f].is_init},c._queuedLoadsForLevel[e][f].is_init&&(d=!0),c._queuedLoadsForLevel[e].splice(f,1)}if(a.length){var i=0,j={id:a.join(";"),init:d?1:"",start:i*c.maxItemsPerHierarchyLevelPage,max:c.maxItemsPerHierarchyLevelPage};jQuery.getJSON(c.levelDataUrl,j,function(a){jQuery.each(a,function(a,d){var e=a.split("|"),f=e[0].split(":"),g=f[0],h=(f[1]?f[1]:0,e[1]?e[1]:0);if(b[h]){var i=b[h].is_init,j=b[h].newLevelDivID,k=b[h].newLevelListID,l=b[h].selected_item_id,m=!1;jQuery("#"+j).data("itemCount",d._itemCount),jQuery.each(d,function(a,b){if(b)if(b.item_id){c.selectedItemIDs[h]==b.item_id&&(m=!0,h>=c.selectedItemIDs.length-1&&c.selectItem(h,c.selectedItemIDs[h],jQuery("#"+j).data("parent_id"),b[c.hasChildrenIndicator],b));var d="",e="",f=0;switch(b.type){case"FILE":if(!c.displayFiles)return;d=c.fileIcon;break;case"DIR":d=c.folderIcon,f=c.displayFiles?b.children:b.subdirectories,e=" ("+f+")"}var g="",n=b.item_id.replace(/[^A-Za-z0-9_\-]+/g,"_");if(c.openDirectoryIcon&&"DIR"==b.type&&(g=f>0?"<div style='float: right;'><a href='#' id='directoryBrowser_"+c.name+"_level_"+h+"_item_"+n+"_open' >"+c.openDirectoryIcon+"</a></div>":"<div style='float: right;'><a href='#' id='directoryBrowser_"+c.name+"_level_"+h+"_item_"+n+"_open'  style='opacity: 0.3;'>"+c.openDirectoryIcon+"</a></div>"),jQuery("#"+k).append("FILE"!=b.type||c.allowFileSelection?"<li class='"+c.className+"'>"+g+"<a href='#' id='directoryBrowser_"+c.name+"_level_"+h+"_item_"+n+"' class='"+c.className+"' title='"+b.fullname+"'>"+d+b.name+e+"</a></li>":"<li class='"+c.className+"'><a href='#' id='directoryBrowser_"+c.name+"_level_"+h+"_item_"+n+"' class='"+c.className+"' title='"+b.fullname+"' style='opacity: 0.5;'>"+d+b.name+"</a></li>"),jQuery("#"+k+" li:last a").data("item_id",b.item_id),c.hasChildrenIndicator&&jQuery("#"+k+" li:last a").data("has_children",b[c.hasChildrenIndicator]?!0:!1),("DIR"==b.type||"FILE"==b.type&&c.allowFileSelection)&&jQuery("#"+k+" li:last a:last").click(function(){var a=jQuery(this).parent().parent().parent().data("level"),d=jQuery(this).data("item_id"),e=jQuery(this).data("has_children");return c.clearLevelsStartingAt(a+1),c.selectItem(a,d,jQuery("#"+j).data("parent_id"),e,b),e&&(c.setUpHierarchyLevel(a+1,d,0,void 0,!0),jQuery("#"+c.container+"_scrolling_container").animate({scrollLeft:a*c.levelWidth},500)),!1}),"DIR"==b.type&&jQuery("#"+k+" li:last a:first").click(c.readOnly?function(){return!1}:function(){var a=jQuery(this).parent().parent().parent().parent().data("level"),d=jQuery(this).data("item_id"),e=jQuery(this).data("has_children");return c.selectItem(a,d,jQuery("#"+j).data("parent_id"),e,b),c.setUpHierarchyLevel(a+1,d,0,void 0,!0),jQuery("#"+c.container+"_scrolling_container").animate({scrollLeft:a*c.levelWidth},500),!1}),i&&c.selectOnLoad&&c.onSelection&&i&&b.item_id==l){{c.currentSelectionDisplayFormat.replace("%1",b.name)}c.onSelection(b.item_id,c.selectedItemIDs.join("/"),b.name,b.type)}}else b.parent_id&&0==c.selectedItemIDs.length&&(c.selectedItemIDs[0]=b.parent_id)});var n=!1;if(!m&&c.selectedItemIDs[h]){var o=jQuery("#"+j).data("page");(!o||0>o)&&(o=0),o++,jQuery("#"+j).data("page",o),jQuery("#"+j).data("itemCount")>o*c.maxItemsPerHierarchyLevelPage&&(c._pageLoadsForLevel[h]&&c._pageLoadsForLevel[h][o]||(c._pageLoadsForLevel[h]||(c._pageLoadsForLevel[h]=[]),c._pageLoadsForLevel[h][o]=!0,c.queueHierarchyLevelDataLoad(h,g,i,j,k,l,o*c.maxItemsPerHierarchyLevelPage,!0),n=!0))}else i=!0;if(i){if(void 0!==c.selectedItemIDs[h]&&!n){var p=c.selectedItemIDs[h].replace(/[^A-Za-z0-9_\-]+/g,"_");jQuery("#directoryBrowser_"+c.name+"_level_"+h+"_item_"+p).addClass(c.classNameSelected),jQuery("#directoryBrowser_"+c.name+"_"+h).scrollTo("#directoryBrowser_"+c.name+"_level_"+h+"_item_"+p)}}else{c.selectedItemIDs[h-1]=g;var p=g.replace(/[^A-Za-z0-9_\-]+/g,"_");jQuery("#directoryBrowser_"+c.name+"_"+(h-1)+" a").removeClass(c.classNameSelected).addClass(c.className),jQuery("#directoryBrowser_"+c.name+"_level_"+(h-1)+"_item_"+p).addClass(c.classNameSelected)}c._numOpenLoads--,c._openLoadsForLevel[h]=!1;var q=l;jQuery("#"+j).scroll(function(){var a=jQuery("#"+j).data("page");if(a||(a=0),jQuery("#"+j).scrollTop()>=a*jQuery("#"+j).height()-10){var b=Math.ceil(jQuery("#"+j).scrollTop()/jQuery("#"+j).height());if(0>b&&(b=0),jQuery("#"+j).data("itemCount")<=b*c.maxItemsPerHierarchyLevelPage)return;jQuery("#"+j).data("page",b);var d=jQuery("#"+j).data("level");c._pageLoadsForLevel[d]&&c._pageLoadsForLevel[d][b]||(c._pageLoadsForLevel[d]||(c._pageLoadsForLevel[d]=[]),c._pageLoadsForLevel[d][b]=!0,c.queueHierarchyLevelDataLoad(d,g,!1,j,k,q,b*c.maxItemsPerHierarchyLevelPage,!0))}}),c.hideIndicator(j),c.loadHierarchyLevelData()}})})}},c.selectItem=function(a,b,d,e,f){if(!c.allowSelection)return!1;var g=c.currentSelectionDisplayFormat.replace("%1",f.name);for(c.currentSelectionDisplayID&&jQuery("#"+c.currentSelectionDisplayID).html(g),c.currentSelectionIDID&&jQuery("#"+c.currentSelectionIDID).attr("value",b);c.selectedItemIDs.length>a;)c.selectedItemIDs.pop();c.selectedItemIDs.push(b);var h=b.replace(/[^A-Za-z0-9_\-]+/g,"_");jQuery("#directoryBrowser_"+c.name+"_"+a+" a").removeClass(c.classNameSelected).addClass(c.className),jQuery("#directoryBrowser_"+c.name+"_level_"+a+"_item_"+h).addClass(c.classNameSelected),c.onSelection&&c.onSelection(b,c.selectedItemIDs.join("/"),f.name,f.type)},c.showIndicator=function(a){if(c.indicatorUrl){if(jQuery("#"+a+" img._indicator").length>0)return void jQuery("#"+a+" img._indicator").show();var b=(jQuery("#"+a).data("level"),document.createElement("img"));b.src=c.indicatorUrl,b.className="_indicator",b.style.position="absolute",b.style.left="50%",b.style.top="50%",jQuery("#"+a).append(b)}},c.formatFilesize=function(a){return a=a>=1073741824?c.formatNumber(a/1073741824,2,".","")+" Gb":a>=1048576?c.formatNumber(a/1048576,2,".","")+" Mb":a>=1024?c.formatNumber(a/1024,0)+" Kb":c.formatNumber(a,0)+" bytes"},c.formatNumber=function(a,b,c,d){var e=a,f=isNaN(b=Math.abs(b))?2:b,g=void 0==c?",":c,h=void 0==d?".":d,i=0>e?"-":"",j=parseInt(e=Math.abs(+e||0).toFixed(f))+"",k=(k=j.length)>3?k%3:0;return i+(k?j.substr(0,k)+h:"")+j.substr(k).replace(/(\d{3})(?=\d)/g,"$1"+h)+(f?g+Math.abs(e-j).toFixed(f).slice(2):"")},c.hideIndicator=function(a){jQuery("#"+a+" img._indicator").hide()},c.getSelectedItemID=function(){return c.selectedItemIDs[c.selectedItemIDs.length-1]},c.numLevels=function(){return c.levelLists.length},c.setUpHierarchy(c.initItemID?c.initItemID:c.defaultItemID),c):(alert("No level data url specified for "+c.name+"!"),null)}}(jQuery);var caUI=caUI||{};!function(){caUI.initDisplayTemplateParser=function(a){var b=jQuery.extend({},a);return b.unitTable={'"':"in","”":"in","in.":"in",inch:"in",inches:"in","'":"ft","’":"ft","ft.":"ft",foot:"ft",feet:"ft","m.":"m",meter:"m",meters:"m",metre:"m",metres:"m",mt:"m","cm.":"cm",centimeter:"cm",centimeters:"cm",centimetre:"cm",centimetres:"cm","mm.":"mm",millimeter:"mm",millimeters:"mm",millimetre:"mm",millimetres:"mm",k:"kilometer",km:"kilometer",kilometers:"kilometer",kilometre:"kilometer",kilometres:"kilometer",pt:"point","pt.":"point",mile:"miles",mi:"miles",lbs:"pounds",lb:"pounds","lb.":"pounds",pound:"pounds",kg:"kilograms","kg.":"kilograms",kilo:"kilograms",kilos:"kilograms",kilogram:"kilograms",g:"grams","g.":"grams",gr:"grams","gr.":"grams",gram:"grams",mg:"milligrams","mg.":"milligrams",milligram:"milligrams",oz:"ounces","oz.":"ounces",ounce:"ounces",tons:"ton",tonne:"ton",tonnes:"ton",t:"ton","t.":"ton"},b.processTemplate=function(a,c){var d=a,e=/\^([\/A-Za-z0-9]+\[[\@\[\]\=\'A-Za-z0-9\.\-\/]+|[A-Za-z0-9_\.:\/]+[%]{1}[^ \^\t\r\n\"\'<>\(\)\{\}\/]*|[A-Za-z0-9_\.~:\/]+)/g,f=a.match(e),g=/[\d\.\,]+(.*)$/;jQuery.each(f,function(a,e){if(-1===e.indexOf("~")){var f=e.replace("^","");d=jQuery("select"+c[f]+" option:selected").length?d.replace(e,jQuery("select"+c[f]+" option:selected").text()):d.replace(e,jQuery(c[f]).val())}else{var h=e.split(/\~/),i=h[0].replace("^",""),f=e.replace("^",""),j=h[1].split(/\:/);switch(j[0].toLowerCase()){case"units":var k=jQuery(c[i]).val();k=b.convertFractionalNumberToDecimal(k);var l=k.match(g);if(!l||l.length<2){d=d.replace(e,k);break}var m=l[1].trim();b.unitTable[m]&&(k=k.replace(m,b.unitTable[m]));try{var n=new Qty(k);d=d.replace(e,n.to(j[1]).toPrec(.2).toString())}catch(o){d=d.replace(e,k)}}}});var h=jQuery("<div>"+d+"</div>");return jQuery.each(f,function(a,b){var d=b.split(/\~/),e=d[0].replace("^",""),f=jQuery(c[e]).val();f&&f.length>0?jQuery.each(h.find("ifdef[code="+e+"]"),function(a,b){jQuery(b).replaceWith(jQuery(b).html())}):h.find("ifdef[code="+e+"]").remove()}),h.html().trim()},b.convertFractionalNumberToDecimal=function(a){if(!a)return"";var b;if(b=a.match(/^([\d]*)[ ]*([\d]+)\/([\d]+)/)){var c="";parseFloat(b[2])>0&&(c=parseFloat(b[2])/parseFloat(b[3])),c+=parseFloat(b[1]),a=a.replace(b[0],c)}return a},b},caDisplayTemplateParser=caUI.initDisplayTemplateParser()}(jQuery);var caUI=caUI||{};!function(a){caUI.initBundle=function(b,c){var d=jQuery.extend({container:b,addMode:"append",templateValues:[],initialValues:{},initialValueOrder:[],forceNewValues:[],errors:{},itemID:"",fieldNamePrefix:"",templateClassName:"caItemTemplate",initialValueTemplateClassName:"caItemTemplate",itemListClassName:"caItemList",listItemClassName:"caRelatedItem",itemClassName:"labelInfo",localeClassName:"labelLocale",addButtonClassName:"caAddItemButton",deleteButtonClassName:"caDeleteItemButton",showOnNewIDList:[],hideOnNewIDList:[],enableOnNewIDList:[],disableOnExistingIDList:[],counter:0,minRepeats:0,maxRepeats:65535,showEmptyFormsOnLoad:1,onInitializeItem:null,onItemCreate:null,onAddItem:null,incrementLocalesForNewBundles:!0,defaultValues:{},bundlePreview:"",readonly:0,totalValueCount:null,partialLoadUrl:null,loadFrom:0,loadSize:5,partialLoadMessage:"Load next %",partialLoadIndicator:null,onPartialLoad:null,placementID:null,interstitialPrimaryTable:null,interstitialPrimaryID:null,sortInitialValuesBy:null,firstItemColor:null,lastItemColor:null,isSortable:!1,listSortOrderID:null,listSortItems:null},c);0==d.maxRepeats&&(d.maxRepeats=65535),d.readonly?(d.showEmptyFormsOnLoad=0,jQuery(b+" ."+d.addButtonClassName).css("display","none")):jQuery(b+" ."+d.addButtonClassName).on("click",null,{},function(a){return d.addToBundle(),d.showUnsavedChangesWarning(!0),a.preventDefault(),!1}),d.showUnsavedChangesWarning=function(a){caUI&&caUI.utils&&"function"==typeof caUI.utils.showUnsavedChangesWarning&&(void 0===a&&(a=!0),caUI.utils.getDisableUnsavedChangesWarning()&&caUI.utils.showUnsavedChangesWarning(a))},d.appendToInitialValues=function(a){jQuery.each(a,function(a,b){return d.initialValues[a]=b,d.addToBundle(a,b,!0),!0}),d.updateBundleFormState()},d.loadNextValues=function(){return d.partialLoadUrl?void jQuery.getJSON(d.partialLoadUrl,{start:d.loadFrom,limit:d.loadSize},function(a){jQuery(d.container+" ."+d.itemListClassName+" #"+d.fieldNamePrefix+"__busy").remove(),jQuery(d.container+" ."+d.itemListClassName+" #"+d.fieldNamePrefix+"__next").remove(),d.loadFrom+=d.loadSize,d.appendToInitialValues(a),jQuery(d.container+" ."+d.itemListClassName).scrollTo("+="+jQuery(d.container+" ."+d.itemListClassName+" div:first").height()+"px",250),d.onPartialLoad&&d.onPartialLoad.call(a),d.partialLoadUrl&&d.totalValueCount>d.loadFrom&&d.addNextValuesLink(),d._updateSortOrderListIDFormElement()}):!1},d.addNextValuesLink=function(){var a=d.loadFrom+d.loadSize;a=a>d.totalValueCount?d.totalValueCount%d.loadSize:d.loadSize;var b=d.partialLoadMessage.replace("%",a+"/"+d.totalValueCount);jQuery(d.container+" ."+d.itemListClassName).append("<div class='caItemLoadNextBundles'><a href='#' id='"+d.fieldNamePrefix+"__next' class='caItemLoadNextBundles'>"+b+"</a><span id='"+d.fieldNamePrefix+"__busy' class='caItemLoadNextBundlesLoadIndicator'>"+d.partialLoadIndicator+"</span></div>"),jQuery(d.container+" ."+d.itemListClassName+" #"+d.fieldNamePrefix+"__next").on("click",function(a){return jQuery(d.container+" ."+d.itemListClassName+" #"+d.fieldNamePrefix+"__busy").show(),d.loadNextValues(),a.preventDefault(),!1})},d.addToBundle=function(b,d,e){var f={},g=!1;d&&!d._handleAsNew?(f.n=b,jQuery.extend(f,d),jQuery.each(this.templateValues,function(a,b){null==f[b]&&(f[b]="")})):(d?(jQuery.extend(f,d),jQuery.each(this.templateValues,function(a,b){null==f[b]&&(f[b]="")}),d._errors&&(this.errors[b]=d._errors)):(d={},jQuery.each(this.templateValues,function(a,b){f[b]=""})),f.n="new_"+this.getCount(),f.error="",g=!0);var h=!1;if(g&&this.incrementLocalesForNewBundles){var i=jQuery.makeArray(jQuery(this.container+" select."+this.localeClassName+":first option"));for(k=0;k<i.length;k++)if(!(jQuery(this.container+" select."+this.localeClassName+" option:selected[value="+i[k].value+"]").length>0)){h=k;break}}var j=[];if(this.errors&&this.errors[b]){var k;for(k=0;k<this.errors[b].length;k++)j.push(this.errors[b][k].errorDescription)}f.error=j.join("<br/>"),f.fieldNamePrefix=this.fieldNamePrefix,b||jQuery.each(this.defaultValues,function(a,b){b&&!f[a]&&(f[a]=b)
});var l=jQuery(this.container+" textarea."+(g?this.templateClassName:this.initialValueTemplateClassName)).template(f);"prepend"==this.addMode&&g?jQuery(this.container+" ."+this.itemListClassName).prepend(l):jQuery(this.container+" ."+this.itemListClassName).append(l),!e&&a.fn.scrollTo&&jQuery(this.container+" ."+this.itemListClassName).scrollTo("999999px",250),this.onInitializeItem&&d&&!d._handleAsNew&&this.onInitializeItem(b,d,this,g);var k,m=this,n=jQuery.makeArray(jQuery(this.container+" select")),o=new RegExp(this.fieldNamePrefix+"([A-Za-z0-9_-]+)_([0-9]+)");for(k=0;k<n.length;k++){var p=n[k].id,q=p.match(o);q&&q[2]&&parseInt(q[2])==b&&(this.initialValues[b]||console.log("err",this.initialValues,this.initialValues[b],b,q,q[1]),"boolean"==typeof this.initialValues[b][q[1]]&&(this.initialValues[b][q[1]]=this.initialValues[b][q[1]]?"1":"0"),jQuery(this.container+" #"+p+" option[value="+this.initialValues[b][q[1]]+"]").prop("selected",!0))}var k,r=jQuery.makeArray(jQuery(this.container+" input[type=checkbox]")),o=new RegExp(this.fieldNamePrefix+"([A-Za-z0-9_-]+)_([0-9]+)");for(k=0;k<r.length;k++){var p=r[k].id,q=p.match(o);q&&q[2]&&parseInt(q[2])==b&&(jQuery(this.container+" #"+p).prop("checked",!1),"boolean"==typeof this.initialValues[b][q[1]]&&(this.initialValues[b][q[1]]=this.initialValues[b][q[1]]?"1":"0"),jQuery(this.container+" #"+p+"[value="+this.initialValues[b][q[1]]+"]").prop("checked",!0))}var k,s=jQuery.makeArray(jQuery(this.container+" input[type=radio]")),o=new RegExp(this.fieldNamePrefix+"([A-Za-z0-9_-]+)_([0-9]+)_([0-9]+)");for(k=0;k<s.length;k++){var p=s[k].id,q=p.match(o);q&&q[2]&&parseInt(q[2])==b&&("boolean"==typeof this.initialValues[b][q[1]]&&(this.initialValues[b][q[1]]=this.initialValues[b][q[1]]?"1":"0"),jQuery(this.container+" #"+p+"[value="+this.initialValues[b][q[1]]+"]").prop("checked",!0))}if(g){var t=this.getCount();this.showOnNewIDList.length>0&&jQuery.each(this.showOnNewIDList,function(a,b){jQuery(m.container+" #"+b+"new_"+t).show()}),this.hideOnNewIDList.length>0&&jQuery.each(this.hideOnNewIDList,function(a,b){jQuery(m.container+" #"+b+"new_"+t).hide()}),this.enableOnNewIDList.length>0&&jQuery.each(this.enableOnNewIDList,function(a,b){jQuery(m.container+" #"+b+"new_"+t).prop("disabled",!1)})}else this.disableOnExistingIDList.length>0&&jQuery.each(this.disableOnExistingIDList,function(a,c){jQuery(m.container+" #"+c+b).prop("disabled",!0)});return this.interstitialButtonClassName&&(!this.readonly&&"hasInterstitialUI"in d&&1==d.hasInterstitialUI?jQuery(this.container+" #"+this.itemID+f.n+" ."+this.interstitialButtonClassName).on("click",null,{},function(a){var b=c.interstitialUrl+"/relation_id/"+d.relation_id+"/placement_id/"+m.placementID+"/n/"+f.n+"/field_name_prefix/"+m.fieldNamePrefix;return m.interstitialPrimaryTable&&m.interstitialPrimaryID&&(b+="/primary/"+m.interstitialPrimaryTable+"/primary_id/"+m.interstitialPrimaryID),c.interstitialPanel.showPanel(b),jQuery("#"+c.interstitialPanel.getPanelContentID()).data("panel",c.interstitialPanel),a.preventDefault(),!1}):jQuery(this.container+" #"+this.itemID+f.n+" ."+this.interstitialButtonClassName).css("display","none")),this.readonly?jQuery(this.container+" #"+this.itemID+f.n+" ."+this.deleteButtonClassName).css("display","none"):jQuery(this.container+" #"+this.itemID+f.n+" ."+this.deleteButtonClassName).on("click",null,{},function(a){return m.deleteFromBundle(f.n),a.preventDefault(),!1}),g&&(h!==!1?jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n+" option:eq("+h+")").length?jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n+" option:eq("+h+")").prop("selected",!0):(jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n).after("<input type='hidden' name='"+this.fieldNamePrefix+"locale_id_"+f.n+"' value='"+m.defaultLocaleID+"'/>"),jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n).remove()):jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n+" option[value="+m.defaultLocaleID+"]").length?jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n+" option[value="+m.defaultLocaleID+"]").prop("selected",!0):(jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n).after("<input type='hidden' name='"+this.fieldNamePrefix+"locale_id_"+f.n+"' value='"+m.defaultLocaleID+"'/>"),jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+f.n).remove())),this.bundlePreview.length>0&&jQuery("#"+this.fieldNamePrefix+"BundleContentPreview").text(this.bundlePreview),this.onAddItem&&this.onAddItem(b?b:f.n,this,g),this.incrementCount(),e||this.updateBundleFormState(),this.onItemCreate&&this.onItemCreate(f.n,this.initialValues[b]),this.readonly&&(jQuery(this.container+" input").prop("disabled",!0),jQuery(this.container+" textarea").prop("disabled",!0),jQuery(this.container+" select").prop("disabled",!0)),this},d.updateBundleFormState=function(){return this.getCount()<=this.minRepeats?jQuery(this.container+" ."+this.deleteButtonClassName).hide():jQuery(this.container+" ."+this.deleteButtonClassName).show(200),this.getCount()>=this.maxRepeats?jQuery(this.container+" ."+this.addButtonClassName).hide():jQuery(this.container+" ."+this.addButtonClassName).show(),(c.firstItemColor||c.lastItemColor)&&(jQuery(this.container+" ."+c.listItemClassName).css("background-color",""),c.firstItemColor&&jQuery(this.container+" ."+c.listItemClassName+":first").css("background-color","#"+c.firstItemColor),c.lastItemColor&&jQuery(this.container+" ."+c.listItemClassName+":last").css("background-color","#"+c.lastItemColor)),this},d.deleteFromBundle=function(a){return jQuery(this.container+" #"+this.itemID+a).remove(),jQuery(this.container).append("<input type='hidden' name='"+d.fieldNamePrefix+a+"_delete' value='1'/>"),this.decrementCount(),this.updateBundleFormState(),d.showUnsavedChangesWarning(!0),this},d.getCount=function(){return this.counter},d.incrementCount=function(){this.counter++},d.decrementCount=function(){this.counter--},d._updateSortOrderListIDFormElement=function(){if(!d.listSortOrderID)return!1;var a=[];return jQuery.each(jQuery(d.container+" ."+d.itemListClassName+" ."+d.itemClassName),function(b,c){a.push(jQuery(c).attr("id").replace(d.itemID,""))}),jQuery("#"+d.listSortOrderID).val(a.join(";")),!0};var e=0,f=[];if(d.initialValueOrder&&d.initialValueOrder.length||jQuery.each(d.initialValues,function(a){d.initialValueOrder.push(a)}),jQuery.each(d.initialValueOrder,function(a,b){var c=d.initialValues[b];c._key=b,f.push(c)}),d.sortInitialValuesBy&&f.sort(function(a,b){return a[d.sortInitialValuesBy]-b[d.sortInitialValuesBy]}),jQuery.each(f,function(a,b){d.addToBundle(b._key,b,!0),e++}),d.loadFrom=e,d.forceNewValues||(d.forceNewValues=[]),jQuery.each(d.forceNewValues,function(a,b){b._handleAsNew=!0,d.addToBundle("new_"+a,b,!0),e++}),e<=d.minRepeats&&d.minRepeats>0){var g;for(g=e;g<d.minRepeats;g++)d.addToBundle(null,null,!0),e++}if(d.showEmptyFormsOnLoad>d.maxRepeats&&(d.showEmptyFormsOnLoad=d.maxRepeats),d.showEmptyFormsOnLoad>0){var h;for(h=0;h<d.showEmptyFormsOnLoad-e;h++)d.addToBundle(null,null,!0)}if(d.isSortable){var i={opacity:.7,revert:.2,scroll:!0,forcePlaceholderSize:!0,update:function(){d._updateSortOrderListIDFormElement(),d.showUnsavedChangesWarning(!0)}};d.listSortItems&&(i.items=d.listSortItems),i.stop=function(){d.updateBundleFormState()},jQuery(d.container+" .caItemList").sortable(i),d._updateSortOrderListIDFormElement()}return d.updateBundleFormState(),d.partialLoadUrl&&d.totalValueCount>d.loadFrom&&d.addNextValuesLink(),d}}(jQuery);var caUI=caUI||{};!function(){caUI.initPanel=function(a){var b=jQuery.extend({panelID:"caPanel",panelContentID:"caPanelContent",useExpose:!0,exposeBackgroundColor:"#000000",exposeBackgroundOpacity:.5,panelTransitionSpeed:200,allowMobileSafariZooming:!1,mobileSafariViewportTagID:"_msafari_viewport",mobileSafariInitialZoom:"1.0",mobileSafariMinZoom:"1.0",mobileSafariMaxZoom:"10.0",mobileSafariDeviceWidth:"device-width",mobileSafariDeviceHeight:"device-height",mobileSafariUserScaleable:!1,onOpenCallback:null,onCloseCallback:null,callbackData:null,center:!1,centerHorizontal:!1,centerVertical:!1,isChanging:!1,clearOnClose:!1},a);return b.showPanel=function(a,c,d,e,f){b.setZoom(b.allowMobileSafariZooming),b.isChanging=!0,(b.center||b.centerHorizontal)&&jQuery("#"+b.panelID).css("left",(jQuery(window).width()-jQuery("#"+b.panelID).width())/2+"px"),(b.center||b.centerVertical)&&jQuery("#"+b.panelID).css("top",(jQuery(window).height()-jQuery("#"+b.panelID).height())/2+"px"),jQuery("#"+b.panelID).fadeIn(b.panelTransitionSpeed,function(){b.isChanging=!1}),b.useExpose&&jQuery("#"+b.panelID).expose({api:!0,color:b.exposeBackgroundColor,opacity:b.exposeBackgroundOpacity,closeOnClick:!1,closeOnEsc:!0}).load(),b.callbackData=f,c&&(b.onCloseCallback=c),e||(e={}),a?(jQuery("#"+b.panelContentID).load(a,e,b.closeButtonSelector?function(){jQuery(b.closeButtonSelector).click(function(){b.hidePanel()})}:null),b.clearOnClose=void 0==d?!0:d):void 0!=d&&(b.clearOnClose=d),b.onOpenCallback&&b.onOpenCallback(a,b.callbackData)},b.hidePanel=function(a){b.onCloseCallback&&b.onCloseCallback(b.callbackData),b.setZoom(!1),b.isChanging=!0,jQuery("#"+b.panelID).fadeOut(b.panelTransitionSpeed,function(){b.isChanging=!1}),!b.useExpose||a&&a.dontCloseMask||jQuery.mask.close(),b.clearOnClose&&(jQuery("#"+b.panelContentID).empty(),b.clearOnClose=!1)},b.panelIsVisible=function(){return jQuery("#"+b.panelID+":visible").length>0?!0:!1},b.getPanelID=function(){return b.panelID},b.getPanelContentID=function(){return b.panelContentID},b.setZoom=function(a){a?jQuery("#"+b.mobileSafariViewportTagID).attr("content","width="+b.mobileSafariDeviceWidth+", height="+b.mobileSafariDeviceHeight+", initial-scale="+b.mobileSafariInitialZoom+", minimum-scale="+b.mobileSafariMinZoom+", maximum-scale="+b.mobileSafariMaxZoom+", user-scalable="+(b.mobileSafariUserScaleable?"yes":"no")):jQuery("#"+b.mobileSafariViewportTagID).attr("content","width="+b.mobileSafariDeviceWidth+", height="+b.mobileSafariDeviceHeight+", initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=yes")},jQuery(document).ready(function(){jQuery(document).keyup(function(a){27==a.keyCode&&!b.isChanging&&b.panelIsVisible()&&b.hidePanel()})}),b}}(jQuery);var caUI=caUI||{};!function(){caUI.initGoogleMap=function(a){var b=jQuery.extend({map:null,id:"map",mapType:"TERRAIN",navigationControl:!0,mapTypeControl:!0,scaleControl:!0,zoomControl:!0},a);return b.infoWindow=new google.maps.InfoWindow({disableAutoPan:!1,maxWidth:300}),b.map=new google.maps.Map(document.getElementById(b.id),{disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId[b.mapType],navigationControl:b.navigationControl,mapTypeControl:b.mapTypeControl,scaleControl:!0,zoomControl:b.zoomControl}),b.openMarkerInfoWindow=function(a){a.getPosition();a.ajaxContentUrl.length>0?(b.infoWindow.setContent("Loading..."),jQuery.ajax(a.ajaxContentUrl,{success:function(c){b.infoWindow.setContent(c),b.infoWindow.open(b.map,a)}})):b.infoWindow.setContent(a.content),b.infoWindow.open(b.map,a)},b.openPathInfoWindow=function(a,c){b.infoWindow.setContent(c.content),b.infoWindow.setPosition(a),b.infoWindow.open(b.map)},b.makeMarker=function(a,c,d,e,f,g){var h=new google.maps.LatLng(a,c),i={position:h,map:b.map,title:d+" ",content:d+" "+e+" ",ajaxContentUrl:f};g&&g.icon&&(i.icon=g.icon);var j=new google.maps.Marker(i);return google.maps.event.addListener(j,"click",function(){b.openMarkerInfoWindow(j)}),j},b.makePath=function(a,c,d,e){var f=new google.maps.Polyline(e);return f.setPath(a),f.setMap(b.map),f.label=c,f.content=d,google.maps.event.addListener(f,"click",function(a){b.openPathInfoWindow(a.latLng,f)}),f},b.closeInfoWindow=function(){b.infoWindow.close()},b.fitBounds=function(a,c,d,e){b.map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(c,e),new google.maps.LatLng(a,d)))},jQuery("#"+b.id).data("mapInstance",b),b}}(jQuery);var caUI=caUI||{};!function(){caUI.initHierBrowser=function(a,b){var c=jQuery.extend({container:a,uiStyle:"horizontal",bundle:"",levelDataUrl:"",initDataUrl:"",editUrl:"",editUrlForFirstLevel:"",editDataForFirstLevel:"",dontAllowEditForFirstLevel:!1,name:b.name?b.name:a.replace(/[^A-Za-z0-9]+/,""),levelWidth:230,browserWidth:500,readOnly:!1,initItemID:null,defaultItemID:null,useAsRootID:null,className:"hierarchyBrowserLevel",classNameSelected:"hierarchyBrowserLevelSelected",classNameContainer:"hierarchyBrowserContainer",currentSelectionDisplayID:"",currentSelectionDisplayFormat:"%1",currentSelectionIDID:"",allowSelection:!0,allowExtractionFromHierarchy:!1,extractFromHierarchyButtonIcon:null,extractFromHierarchyMessage:null,selectOnLoad:!1,onSelection:null,autoShrink:!1,autoShrinkMaxHeightPx:180,autoShrinkAnimateID:"",displayCurrentSelectionOnLoad:!0,typeMenuID:"",indicatorUrl:"",editButtonIcon:"",disabledButtonIcon:"",hasChildrenIndicator:"has_children",alwaysShowChildCount:!0,levelDivs:[],levelLists:[],selectedItemIDs:[],_numOpenLoads:0,_openLoadsForLevel:[],_pageLoadsForLevel:[],_queuedLoadsForLevel:[],maxItemsPerHierarchyLevelPage:500},b);return c.levelDataUrl?(jQuery.inArray(c.uiStyle,["horizontal","vertical"])||(c.uiStyle="horizontal"),"horizontal"==c.uiStyle?jQuery("#"+c.container).append("<div class='"+c.classNameContainer+"' id='"+c.container+"_scrolling_container'></div>"):"vertical"==c.uiStyle&&jQuery("#"+c.container).append("<div class='"+c.classNameContainer+"' id='"+c.container+"_select_container'></div>"),c.typeMenuID&&jQuery("#"+c.typeMenuID).hide(),c.setUpHierarchy=function(a){return a?(c.levelDivs=[],c.levelLists=[],c.selectedItemIDs=[],void jQuery.getJSON(c.initDataUrl,{id:a,bundle:c.bundle},function(b){b.length?(c.selectedItemIDs=b.join(";").split(";"),c.useAsRootID>0?(c.selectedItemIDs.shift(),-1==jQuery.inArray(c.useAsRootID,b)&&b.unshift(c.useAsRootID)):b.unshift(0)):b=[c.useAsRootID?c.useAsRootID:0],b[0]==b[1]&&b.shift();var d=0;jQuery.each(b,function(b,e){c.setUpHierarchyLevel(b,e,1,a),d++}),c.loadHierarchyLevelData(),"horizontal"==c.uiStyle&&jQuery("#"+c.container+"_scrolling_container").animate({scrollLeft:d*c.levelWidth},500)})):void c.setUpHierarchyLevel(0,c.useAsRootID?c.useAsRootID:0,1,null,!0)},c.clearLevelsStartingAt=function(a){for(var b=a;jQuery("#hierBrowser_"+c.name+"_"+b).length>0;)jQuery("#hierBrowser_"+c.name+"_"+b).remove(),c.levelDivs[b]=void 0,c.levelLists[b]=void 0,b++},c.setUpHierarchyLevel=function(a,b,d,e,f){if(c._numOpenLoads++,c._openLoadsForLevel[a])return null;c._openLoadsForLevel[a]=!0,c.clearLevelsStartingAt(a),b||(b=0),d||(d=0);var g="hierBrowser_"+c.name+"_"+a,h="hierBrowser_"+c.name+"_list_"+a;if(d||jQuery("#"+g).remove(),"horizontal"==c.uiStyle){var i="<div class='"+c.className+"' style='left:"+c.levelWidth*a+"px;' id='"+g+"'></div>",j="<ul class='"+c.className+"' id='"+h+"'></ul>";jQuery("#"+c.container+"_scrolling_container").append(i),jQuery("#"+g).data("level",a),jQuery("#"+g).data("parent_id",b),jQuery("#"+g).append(j);var k=e;jQuery("#"+g).scroll(function(){if(jQuery("#"+g).scrollTop()+jQuery("#"+g).height()>=jQuery("#"+g).prop("scrollHeight")){var a=jQuery("#"+g).data("page");if((void 0===a||0==a)&&(a=0),a++,jQuery("#"+g).data("itemCount")<=a*c.maxItemsPerHierarchyLevelPage)return!1;jQuery("#"+g).data("page",a);var d=jQuery("#"+g).data("level");c._pageLoadsForLevel[d]&&c._pageLoadsForLevel[d][a]||(c._pageLoadsForLevel[d]||(c._pageLoadsForLevel[d]=[]),c._pageLoadsForLevel[d][a]=!0,c.queueHierarchyLevelDataLoad(d,b,!1,g,h,k,a*c.maxItemsPerHierarchyLevelPage,!0))}}),c.showIndicator(g)}else if("vertical"==c.uiStyle){var j="<select class='"+c.className+"' id='"+h+"' name='"+h+"' style='width: "+(c.browserWidth-32)+"px;'></select>",i="<div class='"+c.className+"' id='"+g+"'>"+j;a>0&&(i+="<br/>⬆</div>"),jQuery("#"+c.container+"_select_container").prepend(i),jQuery("#"+g).data("level",a),jQuery("#"+g).data("parent_id",b),jQuery("#"+h).change(function(){var b=jQuery("#"+h+" option:selected").val();b?(c.setUpHierarchyLevel(a+1,b,0,void 0,!0),c.selectItem(a,b,jQuery("#"+g).data("parent_id"),0,{})):c.clearLevelsStartingAt(a+1)}),c.showIndicator(g),a>0&&jQuery("#"+h).append(jQuery("<option></option>").val("").html("-")),jQuery("#"+g).parent().parent().scrollTo("0px")}var l=jQuery("#"+g).data("level");return c._pageLoadsForLevel[l]=[!0],c.queueHierarchyLevelDataLoad(a,b,d,g,h,e,0,f),c.levelDivs[a]=g,c.levelLists[a]=h,i},c.queueHierarchyLevelDataLoad=function(a,b,d,e,f,g,h,i){c._queuedLoadsForLevel[a]||(c._queuedLoadsForLevel[a]=[]),c._queuedLoadsForLevel[a].push({item_id:b,is_init:d,newLevelDivID:e,newLevelListID:f,selected_item_id:g,start:h}),i&&c.loadHierarchyLevelData()},c.loadHierarchyLevelData=function(){if(!c.isLoadingLevel){c.isLoadingLevel=!0;for(var a=[],b={},d=!1,e=0;e<c._queuedLoadsForLevel.length;e++)for(var f=0;f<c._queuedLoadsForLevel[e].length;f++)a.push(c._queuedLoadsForLevel[e][f].item_id+":"+c._queuedLoadsForLevel[e][f].start),b[c._queuedLoadsForLevel[e][f].item_id]={level:e,newLevelDivID:c._queuedLoadsForLevel[e][f].newLevelDivID,newLevelListID:c._queuedLoadsForLevel[e][f].newLevelListID,selected_item_id:c._queuedLoadsForLevel[e][f].selected_item_id,is_init:c._queuedLoadsForLevel[e][f].is_init},c._queuedLoadsForLevel[e][f].is_init&&(d=!0),c._queuedLoadsForLevel[e].splice(f,1);if(d){var g=!0;for(var h in b)if(0===b[h].level){g=!1;break}if(g)for(var h in b){var i=b[h].level,j=i-1,k=new RegExp("_"+i+"$");b[h].newLevelDivID=b[h].newLevelDivID.replace(k,"_"+j),b[h].newLevelListID=b[h].newLevelListID.replace(k,"_"+j),b[h].level--}}if(!a.length)return void(c.isLoadingLevel=!1);var l=0;jQuery.getJSON(c.levelDataUrl,{id:a.join(";"),bundle:c.bundle,init:d?1:"",root_item_id:c.selectedItemIDs[0]?c.selectedItemIDs[0]:"",start:l*c.maxItemsPerHierarchyLevelPage,max:"vertical"==c.uiStyle?0:c.maxItemsPerHierarchyLevelPage},function(a){if(jQuery.each(a,function(a,d){var e=a.split(":"),f=e[0];if(b[f]){var g=b[f].level,h=b[f].is_init,i=b[f].newLevelDivID,j=b[f].newLevelListID,k=b[f].selected_item_id,l=!1;jQuery("#"+i).data("itemCount",d._itemCount);for(var m in d._sortOrder){var n=d[d._sortOrder[m]];if(n)if(n.name||(n.name="??? "+n.item_id),n.item_id){if(h&&0==g&&!c.selectedItemIDs[0]&&(c.selectedItemIDs[0]=n.item_id),c.selectedItemIDs[g]==n.item_id&&(l=!0),"horizontal"==c.uiStyle){var o="";if(c.editButtonIcon&&(o=n.children>0?"<div style='float: right;'><a href='#' id='hierBrowser_"+c.name+"_level_"+g+"_item_"+n.item_id+"_edit' >"+c.editButtonIcon+"</a></div>":"<div style='float: right;'><a href='#' id='hierBrowser_"+c.name+"_level_"+g+"_item_"+n.item_id+"_edit'  class='noChildren'>"+c.disabledButtonIcon+"</a></div>"),g>0&&c.allowExtractionFromHierarchy&&c.initItemID==n.item_id&&c.extractFromHierarchyButtonIcon&&(o+="<div style='float: right; margin-right: 5px; opacity: 0.3;' id='hierBrowser_"+c.name+"_extract_container'><a href='#' id='hierBrowser_"+c.name+"_extract'>"+c.extractFromHierarchyButtonIcon+"</a></div>"),jQuery("#"+j).append(void 0!==n.is_enabled&&0===parseInt(n.is_enabled)?"<li class='"+c.className+"'>"+o+n.name+"</li>":0==g&&c.dontAllowEditForFirstLevel?"<li class='"+c.className+"'>"+o+"<a href='#' id='hierBrowser_"+c.name+"_level_"+g+"_item_"+n.item_id+"' class='"+c.className+"'>"+n.name+"</a></li>":"<li class='"+c.className+"'>"+o+"<a href='#' id='hierBrowser_"+c.name+"_level_"+g+"_item_"+n.item_id+"' class='"+c.className+"'>"+n.name+"</a></li>"),jQuery("#"+j+" li:last a").data("item_id",n.item_id),jQuery("#"+j+" li:last a").data("item",n),c.editDataForFirstLevel&&jQuery("#"+j+" li:last a").data(c.editDataForFirstLevel,n[c.editDataForFirstLevel]),c.hasChildrenIndicator&&jQuery("#"+j+" li:last a").data("has_children",n[c.hasChildrenIndicator]?!0:!1),!(0==g&&c.dontAllowEditForFirstLevel||void 0!==n.is_enabled&&1!==parseInt(n.is_enabled))){var p="",q="item_id";c.editUrlForFirstLevel&&0==g?(p=c.editUrlForFirstLevel,c.editDataForFirstLevel&&(q=c.editDataForFirstLevel)):p=c.editUrl,jQuery("#"+j+" li:last a:last").click(p?function(){return jQuery(document).attr("location",p+jQuery(this).data(q)),!1}:function(){var a=jQuery(this).parent().parent().parent().data("level"),b=jQuery(this).data("item_id"),d=jQuery(this).data("has_children");return c.selectItem(a,b,jQuery("#"+i).data("parent_id"),d,jQuery(this).data("item")),!1})}c.readOnly||jQuery("#"+j+" li:last a:first").click(function(){var a=jQuery(this).parent().parent().parent().parent().data("level"),b=jQuery(this).data("item_id"),d=jQuery(this).data("has_children");return c.selectItem(a,b,jQuery("#"+i).data("parent_id"),d,jQuery(this).data("item")),c.setUpHierarchyLevel(a+1,b,0,void 0,!0),jQuery("#"+c.container+"_scrolling_container").animate({scrollLeft:a*c.levelWidth},500),!1}),c.readOnly&&jQuery("#"+j+" li:first a").click(function(){return!1}),c.allowExtractionFromHierarchy&&c.extractFromHierarchyButtonIcon&&jQuery("#"+j+" #hierBrowser_"+c.name+"_extract").unbind("click.extract").bind("click.extract",function(){c.extractItemFromHierarchy(n.item_id,n)})}else"vertical"==c.uiStyle&&jQuery("#"+j).append(jQuery("<option></option>").val(n.item_id).text(n.name));if(h&&c.selectOnLoad&&c.onSelection&&n.item_id==k){var r=c.currentSelectionDisplayFormat.replace("%1",n.name);c.onSelection(n.item_id,n.parent_id,n.name,r,n.type_id)}}else n.parent_id&&0==c.selectedItemIDs.length&&(c.selectedItemIDs[0]=n.parent_id)}var s=!1;if(!l&&c.selectedItemIDs[g]){var t=jQuery("#"+i).data("page");(!t||0>t)&&(t=0),jQuery("#"+i).data("page",t),jQuery("#"+i).data("itemCount")>t*c.maxItemsPerHierarchyLevelPage&&(c._pageLoadsForLevel[g]&&c._pageLoadsForLevel[g][t]||(c._pageLoadsForLevel[g]||(c._pageLoadsForLevel[g]=[]),c._pageLoadsForLevel[g][t]=!0,c.queueHierarchyLevelDataLoad(g,f,!1,i,j,k,t*c.maxItemsPerHierarchyLevelPage,!0),s=!0))}else h=!0;"horizontal"==c.uiStyle?h?void 0===c.selectedItemIDs[g]||s||(jQuery("#hierBrowser_"+c.name+"_level_"+g+"_item_"+c.selectedItemIDs[g]).addClass(c.classNameSelected),jQuery("#hierBrowser_"+c.name+"_"+g).scrollTo("#hierBrowser_"+c.name+"_level_"+g+"_item_"+c.selectedItemIDs[g])):(c.selectedItemIDs[g-1]=f,jQuery("#"+j+" a").removeClass(c.classNameSelected).addClass(c.className),jQuery("#hierBrowser_"+c.name+"_"+(g-1)+" a").removeClass(c.classNameSelected).addClass(c.className),jQuery("#hierBrowser_"+c.name+"_level_"+(g-1)+"_item_"+f).addClass(c.classNameSelected)):"vertical"==c.uiStyle&&(jQuery("#"+j+" option").length<=(g>0?1:0)?jQuery("#"+j).parent().remove():(h&&void 0!==c.selectedItemIDs[g]&&jQuery("#"+j+" option[value="+c.selectedItemIDs[g]+"]").prop("selected",1),(!h&&1==jQuery("#"+j+" option").length||h&&(1==jQuery("#"+j+" option").length||c.selectedItemIDs.length<=1&&0==g))&&c.setUpHierarchyLevel(g+1,jQuery("#"+j+" option:first").val(),0,void 0,!0))),c._numOpenLoads--,c._openLoadsForLevel[g]=!1,c.updateTypeMenu(),"horizontal"==c.uiStyle,c.hideIndicator(i)}}),"horizontal"==c.uiStyle&&c.autoShrink&&c.autoShrinkAnimateID){var d=jQuery("#"+c.autoShrinkAnimateID);if(jQuery(d).is(":visible")){var e=0;for(var f in c.levelLists)if(c.levelLists.hasOwnProperty(f)){var g=jQuery("#"+c.levelLists[f]).height();g>e&&(e=g)}e>c.autoShrinkMaxHeightPx&&(e=c.autoShrinkMaxHeightPx),d.animate({height:e+"px"},500)}}c.isLoadingLevel=!1,c.loadHierarchyLevelData()})}},c.updateTypeMenu=function(){if(0==c._numOpenLoads&&c.currentSelectionDisplayID){for(var a=c.getSelectedItemID(),b=c.numLevels();b>=0;){if(c.displayCurrentSelectionOnLoad&&jQuery("#hierBrowser_"+c.name+"_level_"+b+"_item_"+a).length>0){c.currentSelectionDisplayID&&jQuery("#"+c.currentSelectionDisplayID).html(c.currentSelectionDisplayFormat.replace("%1",jQuery("#hierBrowser_"+c.name+"_level_"+b+"_item_"+a).html()));break}b--}0==c._numOpenLoads&&c.typeMenuID&&jQuery("#"+c.typeMenuID).show(300)}},c.selectItem=function(a,b,d,e,f){if(!c.allowSelection)return!1;var g=c.currentSelectionDisplayFormat.replace("%1",f.name);for(c.currentSelectionDisplayID&&jQuery("#"+c.currentSelectionDisplayID).html(g),c.currentSelectionIDID&&jQuery("#"+c.currentSelectionIDID).attr("value",b),c.onSelection&&c.onSelection(b,d,f.name,g,f.type_id);c.selectedItemIDs.length>a;)c.selectedItemIDs.pop();c.selectedItemIDs.push(b),jQuery("#hierBrowser_"+c.name+"_extract_container").css("opacity",.3),jQuery("#hierBrowser_"+c.name+"_"+a+" a").removeClass(c.classNameSelected).addClass(c.className),jQuery("#hierBrowser_"+c.name+"_level_"+a+"_item_"+b).addClass(c.classNameSelected)},c.extractItemFromHierarchy=function(a,b){c.currentSelectionDisplayID&&jQuery("#"+c.currentSelectionDisplayID).html(c.extractFromHierarchyMessage),c.currentSelectionIDID&&jQuery("#"+c.currentSelectionIDID).attr("value","X"),jQuery("#hierBrowser_"+c.name+"_extract_container").css("opacity",1),c.onSelection&&c.onSelection(a,null,b.name,c.extractFromHierarchyMessage,null)},c.showIndicator=function(a){if(c.indicatorUrl){if(jQuery("#"+a+" img._indicator").length>0)return void jQuery("#"+a+" img._indicator").show();var b=jQuery("#"+a).data("level");if("vertical"==c.uiStyle){var d=document.createElement("img");d.src=c.indicatorUrl,d.className="_indicator",0==b&&jQuery("#"+a).append("<br/>"),jQuery("#"+a).append(d)}else{var d=document.createElement("img");d.src=c.indicatorUrl,d.className="_indicator",d.style.position="absolute",d.style.left="50%",d.style.top="50%",jQuery("#"+a).append(d)}}},c.hideIndicator=function(a){jQuery("#"+a+" img._indicator").hide()},c.getSelectedItemID=function(){return c.selectedItemIDs[c.selectedItemIDs.length-1]},c.numLevels=function(){return c.levelDivs.length},c.setUpHierarchy(c.initItemID?c.initItemID:c.defaultItemID),c):(alert("No level data url specified for "+c.name+"!"),null)}}(jQuery);var caUI=caUI||{};!function(){caUI.initIDNoChecker=function(a){var b=jQuery.extend({errorIcon:null,processIndicator:null,idnoStatusID:"idnoStatus",lookupUrl:null,searchUrl:null,idnoFormElementIDs:[],separator:".",row_id:null,context_id:null,singularAlreadyInUseMessage:"Identifier is already in use",pluralAlreadyInUseMessage:"Identifier is already in use %1 times"},a);return b.checkIDNo=function(){jQuery("#"+b.idnoStatusID).html(b.processIndicator?"<img src='"+b.processIndicator+"' border='0'/>":"");var a=jQuery.makeArray(jQuery(b.idnoFormElementIDs.join(","))),c=[];jQuery.each(a,function(){c.push(this.value)});var d=c.join(b.separator);jQuery.getJSON(b.lookupUrl,{n:d,id:b.row_id,_context_id:b.context_id},function(a){if(a.length>1&&-1===jQuery.inArray(b.row_id,a)||1==a.length&&parseInt(a)!=parseInt(b.row_id)){var c;c=1==a.length?b.singularAlreadyInUseMessage:b.pluralAlreadyInUseMessage.replace("%1",""+a.length),b.searchUrl&&(c="<a href='"+b.searchUrl+d+"'>"+c+"</a>"),jQuery("#"+b.idnoStatusID).html((b.errorIcon?"<img src='"+b.errorIcon+"' border='0'/> ":"")+c).show(0)}else jQuery("#"+b.idnoStatusID).html("").hide(0)})},jQuery(b.idnoFormElementIDs.join(",")).bind("change keyup",b.checkIDNo),b.checkIDNo(),b}}(jQuery);var caUI=caUI||{};!function(){caUI.initImageScroller=function(a,b,c){var d=jQuery.extend({scrollingImageList:a,curScrollImageIndex:c.startImage?c.startImage:0,scrollingImageLookAhead:c.lookAhead?c.lookAhead:3,scrollingImageScrollSpeed:c.scrollSpeed?c.scrollSpeed:.25,containerWidth:c.containerWidth?c.containerWidth:400,containerHeight:c.containerHeight?c.containerHeight:400,container:b?b:"scrollingImages",imageCounterID:c.imageCounterID,imageZoomLinkID:c.imageZoomLinkID,imageZoomLinkImg:c.imageZoomLinkImg,counterLabel:c.counterLabel?c.counterLabel:"",imageTitleID:c.imageTitleID?c.imageTitleID:"",noVertCentering:c.noVertCentering,noHorizCentering:c.noHorizCentering,noImageLink:c.noImageLink,scrollingImageClass:c.scrollingImageClass?c.scrollingImageClass:"imageScrollerImage",scrollingImageIDPrefix:c.scrollingImageIDPrefix?c.scrollingImageIDPrefix:"imageScrollerImage",initialIndex:0},c);return d.getCurrentIndex=function(){return this.curScrollImageIndex},d.scrollToNextImage=function(){this.scrollToImage(1)},d.scrollToPreviousImage=function(){d.scrollToImage(-1)},d.scrollToImage=function(a,b){var c=d.curScrollImageIndex+a;if(0>c||c>=d.scrollingImageList.length)return!1;var e,f=c+d.scrollingImageLookAhead;f>=d.scrollingImageList.length&&(f=d.scrollingImageList.length-1);var g=c-d.scrollingImageLookAhead;for(0>g&&(g=0),e=g;f>=e;e++)if(0==jQuery("#"+d.scrollingImageIDPrefix+e).length){var h,i,j,k;h=d.noHorizCentering?"":"margin-left: "+(d.containerWidth-d.scrollingImageList[e].width)/2+"px;",i=d.noVertCentering?"":"margin-top: "+(d.containerHeight-d.scrollingImageList[e].height)/2+"px;",d.noImageLink?j=k="":(j='<a href="'+d.scrollingImageList[e].link+'" '+(d.scrollingImageList[e].onclick?'onclick="'+d.scrollingImageList[e].onclick+'"':"")+" "+(d.scrollingImageList[e].rel?'rel="'+d.scrollingImageList[e].rel+'"':"")+">",k="</a>"),jQuery("#"+d.container).append('<div class="'+d.scrollingImageClass+'" id="'+d.scrollingImageIDPrefix+e+'" style="'+h+" "+i+'">'+j+'<img src="'+d.scrollingImageList[e].url+'" width="'+d.scrollingImageList[e].width+'" height ="'+d.scrollingImageList[e].height+"\" border='0'>"+k+"</div>"),jQuery("#"+d.scrollingImageIDPrefix+e).css("left",d.containerWidth*e+"px")}b?jQuery("#"+d.container).css("left",-1*c*d.containerWidth+"px"):jQuery("#"+d.container).animate({left:-1*c*d.containerWidth+"px"},1e3*d.scrollingImageScrollSpeed),d.imageTitleID&&jQuery("#"+d.imageTitleID).html(d.scrollingImageList[c].title),d.imageCounterID&&jQuery("#"+d.imageCounterID).html(d.counterLabel+(c+1)+"/"+d.scrollingImageList.length),d.curScrollImageIndex=c,d.imageZoomLinkID&&jQuery("#"+d.imageZoomLinkID).html('<a href="#" '+(d.scrollingImageList[c].onclickZoom?'onclick="'+d.scrollingImageList[c].onclickZoom+'"':"")+">"+d.imageZoomLinkImg+"</a>")},d.scrollToImage(d.initialIndex,!0),d}}(jQuery);var caUI=caUI||{};!function(){caUI.initLabelBundle=function(a,b){var c=jQuery.extend({container:a,mode:"preferred",templateValues:[],initialValues:{},forceNewValues:[],labelID:"Label_",fieldNamePrefix:"",localeClassName:"caLabelLocale",templateClassName:"caLabelTemplate",labelListClassName:"caLabelList",addButtonClassName:"caAddLabelButton",deleteButtonClassName:"caDeleteLabelButton",defaultLocaleID:null,bundlePreview:"",readonly:0,counter:0},b);c.readonly?jQuery(a+" ."+c.addButtonClassName).css("display","none"):jQuery(a+" ."+c.addButtonClassName).click(function(){return c.addLabelToLabelBundle(a),c.showUnsavedChangesWarning(!0),!1}),c.showUnsavedChangesWarning=function(a){"function"==typeof caUI.utils.showUnsavedChangesWarning&&(void 0===a&&(a=!0),caUI.utils.showUnsavedChangesWarning(a))},c.addLabelToLabelBundle=function(a,c,d){void 0==d&&(d=!1);var e={},f=!1;c?(e.n=d?"new_"+this.getCount():a,jQuery.extend(e,c)):(c={},jQuery.each(this.templateValues,function(a,b){e[b]=""}),e.n="new_"+this.getCount(),f=!0),e.fieldNamePrefix=this.fieldNamePrefix;var g=jQuery(this.container+" textarea."+this.templateClassName).template(e);jQuery(this.container+" ."+this.labelListClassName).append(g);var h=this;h.readonly?jQuery(this.container+" #"+this.fieldNamePrefix+this.labelID+e.n+" ."+this.deleteButtonClassName).css("display","none"):jQuery(this.container+" #"+this.fieldNamePrefix+this.labelID+e.n+" ."+this.deleteButtonClassName).click(function(){return h.deleteLabelFromLabelBundle(e.n),!1});var i=jQuery.makeArray(jQuery(this.container+" select."+this.localeClassName+":first option")),j=0;for(k=0;k<i.length;k++){if(f){if(jQuery(this.container+" select."+this.localeClassName+" option:selected[value="+i[k].value+"]").length>0&&jQuery(this.container+" select."+this.localeClassName).length>1)continue}else if(i[k].value!==e.locale_id)continue;if(j=k,f&&i[k].value==b.defaultLocaleID)break}var k;for(k=0;k<this.templateValues.length;k++)"locale_id"!==this.templateValues[k]&&jQuery(this.container+" select#"+this.fieldNamePrefix+this.templateValues[k]+"_"+a).length&&jQuery(this.container+" select#"+this.fieldNamePrefix+this.templateValues[k]+"_"+a+" option[value="+e[this.templateValues[k]]+"]").prop("selected",!0);if(e.locale_id||(e.locale_id=h.defaultLocaleID),f?jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n+" option:eq("+j+")").length?jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n+" option:eq("+j+")").prop("selected",!0):(jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n).after("<input type='hidden' name='"+this.fieldNamePrefix+"locale_id_"+e.n+"' value='"+h.defaultLocaleID+"'/>"),jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n).remove()):(jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n+" option:eq("+j+")").prop("selected",!0),jQuery(this.container+" #"+this.fieldNamePrefix+"locale_id_"+e.n).change(function(){h.updateLabelBundleFormState()
})),this.bundlePreview.length>0){var l;l="preferred"==this.mode?"#"+this.fieldNamePrefix+"Labels_BundleContentPreview":"#"+this.fieldNamePrefix+"NPLabels_BundleContentPreview",jQuery(l).text(this.bundlePreview)}return this.updateLabelBundleFormState(),this.incrementCount(),this},c.updateLabelBundleFormState=function(){switch(this.mode){case"preferred":var a,b=jQuery.makeArray(jQuery(this.container+" ."+this.labelListClassName+" select."+this.localeClassName+" option:selected")),c=[];for(a=0;a<b.length;a++)c.push(b[a].value);var d=jQuery.makeArray(jQuery(this.container+" ."+this.labelListClassName+" select."+this.localeClassName));for(a=0;a<d.length;a++){var e,f=d[a].options[d[a].selectedIndex].value;for(e=0;e<d[a].options.length;e++)d[a].options[e].disabled=jQuery.inArray(d[a].options[e].value,c)>=0&&d[a].options[e].value!=f?!0:!1}var g=jQuery(this.container+" ."+this.labelListClassName+" > div").length;b=jQuery.makeArray(jQuery(this.container+" ."+this.labelListClassName+" select."+this.localeClassName+":first")),g>0&&(!b||!b[0]||b[0].options.length<=jQuery(this.container+" ."+this.labelListClassName+" div select."+this.localeClassName).length)?jQuery(this.container+" ."+this.addButtonClassName).hide():jQuery(this.container+" ."+this.addButtonClassName).show(200)}return this.readonly&&(jQuery(this.container+" input").prop("disabled",!0),jQuery(this.container+" select").prop("disabled",!0)),this},c.deleteLabelFromLabelBundle=function(a){return jQuery(this.container+" #"+this.fieldNamePrefix+"Label_"+a).remove(),jQuery(this.container).append("<input type='hidden' name='"+c.fieldNamePrefix+"Label_"+a+"_delete' value='1'/>"),this.updateLabelBundleFormState(),c.showUnsavedChangesWarning(!0),this},c.getCount=function(){return this.counter},c.incrementCount=function(){this.counter++};var d=0;return jQuery.each(c.initialValues,function(a,b){c.addLabelToLabelBundle(a,b),d++}),jQuery.each(c.forceNewValues,function(a,b){c.addLabelToLabelBundle(a,b,!0),d++}),0==d&&c.addLabelToLabelBundle(),c.updateLabelBundleFormState(),c}}(jQuery);var caUI=caUI||{};!function(){caUI.initObjectCheckinManager=function(a){var b=jQuery.extend({transactionListContainerID:"transactionListContainer",transactionSubmitContainerID:"transactionSubmitContainer",transactionResultsContainerID:"transactionResultsContainer",autocompleteID:"objectAutocomplete",itemList:[],searchURL:null,getInfoURL:null,saveTransactionURL:null,loadWidgetURL:null,removeButtonIcon:"(X)",cookieJar:jQuery.cookieJar("caBundleVisibility")},a);return jQuery("#"+b.transactionListContainerID).hide(),jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionResultsContainerID).hide(),jQuery("#"+b.autocompleteID).autocomplete({source:b.searchURL,minLength:3,delay:800,html:!0,response:function(a,b){1==b.content.length&&b.content[0].id>0&&(b.item=b.content[0],jQuery(this).data("ui-autocomplete")._trigger("select","autocompleteselect",b),jQuery(this).autocomplete("close"))},select:function(a,c){var d=c.item.id;if(parseInt(d)){if(0>=d)return jQuery("#"+b.autocompleteID).val(""),!1;var e=!1;if(jQuery.each(b.itemList,function(a,c){return c.checkout_id==d?(e=!0,jQuery("#"+b.autocompleteID).val(""),!1):void 0}),e)return!1;jQuery.getJSON(b.getInfoURL+"/checkout_id/"+d,{},function(a){var c='<div class="caLibraryTransactionListItemContainer"><div class="caLibraryTransactionListItemMedia">'+a.media+'</div><div class="caLibraryTransactionListItemName">'+a.title+"</div>";c+='<div class="caLibraryTransactionListItemBorrower">'+a.borrower+"</div>",c+='<div class="caLibraryTransactionListItemNotesContainer"><div class="caLibraryTransactionListItemNotesLabel">Notes</div><textarea name="note" id="note_'+d+'" rows="2" cols="90"></textarea></div>',c+='<div class="caLibraryTransactionListItemRemoveButton"><a href="#" id="itemRemove_'+d+'" data-checkout_id="'+d+'">'+b.removeButtonIcon+"</a>",jQuery("#"+b.transactionListContainerID+" .transactionList").append("<li id='item_"+d+"'>"+c+"</li>"),jQuery("#itemRemove_"+d).on("click",function(){var a=jQuery(this).data("checkout_id");jQuery("li#item_"+a).remove();var c=[];jQuery.each(b.itemList,function(b,d){d.checkout_id!=a&&c.push(d)}),b.itemList=c,0==b.itemList.length&&(jQuery("#"+b.transactionListContainerID).hide(),jQuery("#"+b.transactionSubmitContainerID).hide())}),b.itemList.push({checkout_id:d}),b.itemList.length>0?(jQuery("#"+b.transactionSubmitContainerID).show(),jQuery("#"+b.transactionListContainerID).show()):(jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionListContainerID).hide()),jQuery("#"+b.autocompleteID).val("")})}}}).click(function(){this.select()}).focus(),jQuery("#transactionSubmit").on("click",function(){b.itemList.length>0&&(jQuery.each(b.itemList,function(a,c){var d=c.checkout_id,e=jQuery("#note_"+d).val();e&&(b.itemList[a].note=e)}),jQuery.ajax({url:b.saveTransactionURL,type:"POST",dataType:"json",data:{user_id:b.user_id,item_list:JSON.stringify(b.itemList)},success:function(a){jQuery("#"+b.transactionListContainerID+" .transactionList li").remove(),b.itemList=[],jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionListContainerID).hide(),jQuery("#"+b.autocompleteID).focus(),jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses li").remove(),jQuery("#"+b.transactionResultsContainerID+" .transactionErrors li").remove(),a.checkins&&(jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses li").remove(),jQuery.each(a.checkins,function(a,c){jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses").append("<li>"+c+"</li>")})),a.errors&&(jQuery("#"+b.transactionResultsContainerID+" .transactionErrors li").remove(),jQuery.each(a.errors,function(a,c){jQuery("#"+b.transactionResultsContainerID+" .transactionErrors").append("<li>"+c+"</li>")})),b.loadWidgetURL&&jQuery("#widgets").load(b.loadWidgetURL),jQuery("#"+b.transactionResultsContainerID).fadeIn(250),setTimeout(function(){jQuery("#"+b.transactionResultsContainerID).fadeOut(250)},5e3)},error:function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)}}))}),b.xxx=function(){},b}}(jQuery);var caUI=caUI||{};!function(){caUI.initObjectCheckoutManager=function(a){var b=jQuery.extend({user_id:null,transactionListContainerID:"transactionListContainer",transactionSubmitContainerID:"transactionSubmitContainer",transactionResultsContainerID:"transactionResultsContainer",autocompleteID:"objectAutocomplete",itemList:[],searchURL:null,getInfoURL:null,saveTransactionURL:null,loadWidgetURL:null,removeButtonIcon:"(X)",cookieJar:jQuery.cookieJar("caBundleVisibility")},a);return jQuery("#"+b.transactionListContainerID).hide(),jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionResultsContainerID).hide(),jQuery("#"+b.autocompleteID).autocomplete({source:b.searchURL,minLength:3,delay:800,html:!0,response:function(a,b){1==b.content.length&&b.content[0].id>0&&(b.item=b.content[0],jQuery(this).data("ui-autocomplete")._trigger("select","autocompleteselect",b),jQuery(this).autocomplete("close"))},select:function(a,c){var d=c.item.id;if(parseInt(d)){if(0>=d)return jQuery("#"+b.autocompleteID).val(""),!1;var e=(c.item.due_date,!1);if(jQuery.each(b.itemList,function(a,c){return c.object_id==d?(e=!0,jQuery("#"+b.autocompleteID).val(""),!1):void 0}),e)return!1;jQuery.getJSON(b.getInfoURL,{object_id:d,user_id:b.user_id},function(a){var c='<div class="caLibraryTransactionListItemContainer"><div class="caLibraryTransactionListItemMedia">'+a.media+'</div><div class="caLibraryTransactionListItemName">'+a.title+"</div>";c+="<div>Status: "+a.status_display+"</div>",a.storage_location&&(c+="<div>Location: "+a.storage_location+"</div>"),1!=a.status&&2!=a.status||a.isOutWithCurrentUser||a.isReservedByCurrentUser||(b.user_id==a.current_user_id||1!=a.status&&2!=a.status||(c+='<div class="caLibraryTransactionListItemWillReserve">'+a.reserve_display_label+" ("+a.holder_display_label+")</div>"),b.user_id!=a.current_user_id&&3==a.status&&(c+='<div class="caLibraryTransactionListItemWillReserve">'+a.reserve_display_label+"</div>")),0==a.status||3==a.status?(c+='<div class="caLibraryTransactionListItemNotesContainer"><div class="caLibraryTransactionListItemNotesLabel">'+a.notes_display_label+'</div><textarea name="note" id="note_'+d+'" rows="2" cols="90"></textarea></div>',0!=a.status&&3!=a.status||1!=a.config.allow_override_of_due_dates||(c+='<div class="caLibraryTransactionListItemDueDateContainer"><div class="caLibraryTransactionListItemDueDateLabel">'+a.due_on_display_label+'</div><input type="text" name="due_date" id="dueDate_'+d+'" value="'+a.config.default_checkout_date+'" size="10"/></div>')):c+='<br style="clear: both;"/>',c+='<div class="caLibraryTransactionListItemRemoveButton"><a href="#" id="itemRemove_'+d+'" data-object_id="'+d+'">'+b.removeButtonIcon+"</a></div>",jQuery("#"+b.transactionListContainerID+" .transactionList").append("<li id='item_"+d+"'>"+c+"</li>"),jQuery("#itemRemove_"+d).on("click",function(){var a=jQuery(this).data("object_id");jQuery("li#item_"+a).remove();var c=[];jQuery.each(b.itemList,function(b,d){d.object_id!=a&&c.push(d)}),b.itemList=c,0==b.itemList.length&&(jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionListContainerID).hide())}),b.itemList.push({object_id:d,due_date:null}),jQuery("#dueDate_"+d).datepicker({minDate:0,dateFormat:"yy-mm-dd"}),b.itemList.length>0?(jQuery("#"+b.transactionSubmitContainerID).show(),jQuery("#"+b.transactionListContainerID).show()):(jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionListContainerID).hide()),jQuery("#"+b.autocompleteID).val("")})}}}).click(function(){this.select()}).focus(),jQuery("#transactionSubmit").on("click",function(){b.itemList.length>0&&(jQuery.each(b.itemList,function(a,c){var d=c.object_id,e=jQuery("#dueDate_"+d).val();e&&(b.itemList[a].due_date=e);var f=jQuery("#note_"+d).val();f&&(b.itemList[a].note=f)}),jQuery.ajax({url:b.saveTransactionURL,type:"POST",dataType:"json",data:{user_id:b.user_id,item_list:JSON.stringify(b.itemList)},success:function(a){jQuery("#"+b.transactionListContainerID+" .transactionList li").remove(),b.itemList=[],jQuery("#"+b.transactionSubmitContainerID).hide(),jQuery("#"+b.transactionListContainerID).hide(),jQuery("#"+b.autocompleteID).focus(),jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses li").remove(),jQuery("#"+b.transactionResultsContainerID+" .transactionErrors li").remove(),a.checkouts&&(jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses li").remove(),jQuery.each(a.checkouts,function(a,c){jQuery("#"+b.transactionResultsContainerID+" .transactionSuccesses").append("<li>"+c+"</li>")})),a.errors&&(jQuery("#"+b.transactionResultsContainerID+" .transactionErrors li").remove(),jQuery.each(a.errors,function(a,c){jQuery("#"+b.transactionResultsContainerID+" .transactionErrors").append("<li>"+c+"</li>")})),b.loadWidgetURL&&b.user_id&&jQuery("#widgets").load(b.loadWidgetURL,{user_id:b.user_id}),jQuery("#"+b.transactionResultsContainerID).fadeIn(250),setTimeout(function(){jQuery("#"+b.transactionResultsContainerID).fadeOut(250)},5e3)},error:function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)}}))}),b.xxx=function(){},b}}(jQuery);var caUI=caUI||{};!function(a){caUI.initQuickAddFormHandler=function(b){var c=jQuery.extend({formID:null,formErrorsPanelID:null,formTypeSelectID:null,fileUploadUrl:null,saveUrl:null,headerText:"QuickAdd",saveText:"Saved record: %1",sendingFilesText:"Sending files (%1)",sendingDataText:"Processing form",busyIndicator:"",_files:{}},b);return jQuery("#"+c.formID).on("change","input[type=file]",function(a){c._files[jQuery(a.target).prop("name")]=a.target.files}),c.save=function(b){jQuery("#"+c.formID).find(".quickAddProgress").html(c.sendingDataText),jQuery.each(CKEDITOR.instances,function(a,b){b.updateElement()});var d=jQuery("#"+c.formID).serializeObject(),e=jQuery("#"+c.formID).parent().data("relatedID"),f=jQuery("#"+c.formID).parent().data("relatedTable"),g=jQuery("#"+c.formID).parent().data("relationshipType");if(jQuery.extend(d,{relatedID:e,relatedTable:f,relationshipType:g}),Object.keys(c._files).length>0){jQuery("#"+c.formID).find(".quickAddProgress").html((c.busyIndicator?c.busyIndicator+" ":"")+c.sendingFilesText.replace("%1","0%"));var h=new FormData;jQuery.each(c._files,function(a,b){h.append(a,b[0])}),a.ajax({url:c.fileUploadUrl,type:"POST",data:h,cache:!1,dataType:"json",processData:!1,contentType:!1,xhr:function(){var a=new window.XMLHttpRequest;return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100);jQuery("#"+c.formID).find(".quickAddProgress").html((c.busyIndicator?c.busyIndicator+" ":"")+c.sendingFilesText.replace("%1",b+"%"))}},!1),a},success:function(a){"undefined"==typeof a.error?(jQuery.each(a,function(a,b){d[a]=b}),c.post(b,d)):(c.setErrors(["Service error "+a.error]),jQuery("#"+c.formID).find(".quickAddProgress").empty())},error:function(a,b){c.setErrors(["Network error "+b]),jQuery("#"+c.formID).find(".quickAddProgress").empty()}})}else c.post(b,d)},c.post=function(a,b){jQuery("#"+c.formID).find(".quickAddProgress").html((c.busyIndicator?c.busyIndicator+" ":"")+c.sendingDataText),jQuery.post(c.saveUrl,b,function(a){if(0==a.status){var d=jQuery("#"+c.formID).parent().data("autocompleteInputID"),e=jQuery("#"+c.formID).parent().data("autocompleteItemIDID"),f=jQuery("#"+c.formID).parent().data("autocompleteTypeIDID"),g=jQuery("#"+c.formID).parent().data("relationbundle");jQuery("#"+d).val(a.display),jQuery("#"+e).val(a.id),jQuery("#"+f).val(a.type_id),g&&g.select(null,a),jQuery.jGrowl(c.saveText.replace("%1",a.display),{header:c.headerText}),jQuery("#"+c.formID).parent().data("panel").hidePanel(),b.relatedID&&caBundleUpdateManager&&(caBundleUpdateManager.reloadBundle("ca_objects_location"),caBundleUpdateManager.reloadBundle("ca_objects_history"),caBundleUpdateManager.reloadInspector())}else c.setErrors(a.errors);jQuery("#"+c.formID).find(".quickAddProgress").empty()},"json")},c.setErrors=function(a){var b='<div class="notification-error-box rounded"><ul class="notification-error-box">';for(var d in a)b+='<li class="notification-error-box">'+d+"</li>";b+="</ul></div>",jQuery("#"+c.formErrorsPanelID).html(b).slideDown(200);var e=setInterval(function(){jQuery("#"+c.formErrorsPanelID).slideUp(500),clearInterval(e)},3e3)},c.switchForm=function(){jQuery.each(CKEDITOR.instances,function(a,b){b.updateElement()}),jQuery("#"+c.formID+" input[name=type_id]").val(jQuery("#"+c.formTypeSelectID).val());var a=jQuery("#"+c.formID).serializeObject();jQuery("#"+c.formID).parent().load(c.formUrl,a)},c}}(jQuery);var caUI=caUI||{};!function(a){a.widget("ui.relationshipLookup",a.ui.autocomplete,{_renderItem:function(a,b){var c=jQuery("<li>").attr("data-value",b.value).append(jQuery("<a>").html(b.label)).appendTo(a);return b.id<=0&&(jQuery(c).find("a").removeClass().addClass("quickaddMenuItem"),jQuery(c).removeClass().addClass("quickaddMenuItem")),c}}),caUI.initRelationBundle=function(b,c){c.onInitializeItem=function(a,b,c){jQuery("#"+c.itemID+a+" select").css("display","inline");var d,e,f=[],g=b.item_type_id;if(c.relationshipTypes&&c.relationshipTypes._type_map&&c.relationshipTypes._type_map[g]&&(g=c.relationshipTypes._type_map[g]),c.relationshipTypes&&(e=c.relationshipTypes[g]))for(d=0;d<e.length;d++)f.push({type_id:e[d].type_id,typename:e[d].typename,direction:e[d].direction});if(c&&c.lists&&c.lists.length&&(c.extraParams||(c.extraParams={}),"object"!=typeof c.lists&&(c.lists=[c.lists]),c.extraParams.lists=c.lists.join(";")),c&&c.types&&c.types.length&&(c.extraParams||(c.extraParams={}),"object"!=typeof c.types&&(c.types=[c.types]),c.extraParams.types=c.types.join(";")),c.relationshipTypes&&(e=c.relationshipTypes.NULL))for(d=0;d<e.length;d++)f.push({type_id:e[d].type_id,typename:e[d].typename,direction:e[d].direction})},c.onAddItem=function(b,c,e){if(e){var f=c.itemID+b+" #"+c.fieldNamePrefix+"autocomplete"+b;jQuery("#"+f).relationshipLookup(jQuery.extend({minLength:parseInt(c.minChars)>0?c.minChars:3,delay:800,html:!0,source:function(b,d){a.ajax({url:c.autocompleteUrl,dataType:"json",data:jQuery.extend(c.extraParams,{term:b.term}),success:function(a){d(a)}})},select:function(a,e){if(c.autocompleteOptions&&c.autocompleteOptions.onSelect&&!c.autocompleteOptions.onSelect(f,e.item))return!1;if(!parseInt(e.item.id)&&c.quickaddPanel){var g=c.quickaddUrl;return c&&c.types&&("[object Array]"===Object.prototype.toString.call(c.types)&&(c.types=c.types.join(",")),c.types.length>0&&(g+="/types/"+c.types)),c.quickaddPanel.showPanel(g,null,null,{q:e.item._query,field_name_prefix:c.fieldNamePrefix}),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("autocompleteInputID",f),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("autocompleteItemIDID",c.itemID+b+" #"+c.fieldNamePrefix+"id"+b),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("autocompleteTypeIDID",c.itemID+b+" #"+c.fieldNamePrefix+"type_id"+b),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("panel",c.quickaddPanel),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("relationbundle",d),jQuery("#"+c.quickaddPanel.getPanelContentID()).data("autocompleteInput",jQuery("#"+c.autocompleteInputID+b).val()),jQuery("#"+c.autocompleteInputID+b).val(""),void a.preventDefault()}return!parseInt(e.item.id)||e.item.id<=0?(jQuery("#"+f).val(""),void a.preventDefault()):(c.select(b,e.item),jQuery("#"+f).val(jQuery.trim(e.item.label.replace(/<\/?[^>]+>/gi,""))),void a.preventDefault())},change:function(){jQuery("#"+c.itemID+b+" #"+c.fieldNamePrefix+"id"+b).val()||jQuery("#"+f).val("")}},c.autocompleteOptions)).on("click",null,{},function(){this.select()})}},c.select=function(a,b){a||(a="new_"+(d.getCount()-1));var e=b.id,f=b.type_id?b.type_id:"";if(!(parseInt(e)<0)){jQuery("#"+c.itemID+a+" #"+c.fieldNamePrefix+"id"+a).val(e),jQuery("#"+c.itemID+a+" #"+c.fieldNamePrefix+"type_id"+a).css("display","inline");var g,h,i=[],j=0;if(jQuery("#"+c.itemID+a+" select[name="+c.fieldNamePrefix+"type_id"+a+"]").data("item_type_id")==f);else{if(c.relationshipTypes&&(h=c.relationshipTypes[f]))for(g=0;g<h.length;g++)i.push({type_id:h[g].type_id,typename:h[g].typename,direction:h[g].direction,rank:h[g].rank}),1===parseInt(h[g].is_default)&&(j=(h[g].direction?h[g].direction:"")+h[g].type_id);if(c.relationshipTypes&&(h=c.relationshipTypes.NULL))for(g=0;g<h.length;g++)i.push({type_id:h[g].type_id,typename:h[g].typename,direction:h[g].direction,rank:h[g].rank}),1===parseInt(h[g].is_default)&&(j=(h[g].direction?h[g].direction:"")+h[g].type_id);i.sort(function(a,b){return a.rank=parseInt(a.rank),b.rank=parseInt(b.rank),a.rank!=b.rank?a.rank>b.rank?1:b.rank>a.rank?-1:0:a.typename>b.typename?1:b.typename>a.typename?-1:0}),jQuery("#"+c.itemID+a+" select#"+c.fieldNamePrefix+"type_id"+a+" option").remove(),jQuery.each(i,function(b,d){var e=d.direction?d.direction+"_":"";jQuery("#"+c.itemID+a+" select#"+c.fieldNamePrefix+"type_id"+a).append("<option value='"+e+d.type_id+"'>"+d.typename+"</option>")}),jQuery("#"+c.itemID+a+" select#"+c.fieldNamePrefix+"type_id"+a+' option[value="'+j+'"]').prop("selected",!0),jQuery("#"+c.itemID+a+" select#"+c.fieldNamePrefix+"type_id"+a).data("item_type_id",f)}d.showUnsavedChangesWarning(!0)}},c.sort=function(a){var b={};jQuery.each(jQuery(d.container+" .bundleContainer ."+d.itemListClassName+" .roundedRel"),function(c,d){var e=jQuery(d).attr("id");if(e){var f;"name"==a?f=jQuery("#"+e+" .itemName").text()+"/"+e:"type"==a?f=jQuery("#"+e+" .itemType").text()+"/"+e:"idno"==a?f=jQuery("#"+e+" .itemIdno").text()+"/"+e:(alert(e),f=e),b[f]=d}jQuery(d).detach()}),b=caUI.utils.sortObj(b,!0);var c=jQuery(d.container+" .bundleContainer ."+d.itemListClassName).html();jQuery(d.container+" .bundleContainer ."+d.itemListClassName).html(""),jQuery.each(b,function(a,b){jQuery(d.container+" .bundleContainer ."+d.itemListClassName).append(b);var c=jQuery(b).attr("id");d.setDeleteButton(c)}),jQuery(d.container+" .bundleContainer ."+d.itemListClassName).append(c),caUI.utils.showUnsavedChangesWarning(!0),d._updateSortOrderListIDFormElement()},c.setDeleteButton=function(a){if(a){var b=a.split("_").pop();jQuery("#"+a+" .caDeleteItemButton").on("click",null,{},function(a){return d.deleteFromBundle(b),a.preventDefault(),!1})}};var d=caUI.initBundle(b,c);return d}}(jQuery);var caUI=caUI||{};!function(){caUI.seteditor=function(a){var b=jQuery.extend({setID:null,table_num:null,fieldNamePrefix:null,setEditorID:"setItemEditor",setItemListID:"setItemList",setNoItemWarningID:"setNoItemsWarning",setItemAutocompleteID:"setItemAutocompleter",rowIDListID:"setRowIDList",lookupURL:null,itemInfoURL:null,editSetItemsURL:null,editSetItemButton:null,initialValues:null,initialValueOrder:null},a);return b.initSetEditor=function(){jQuery("#"+b.setItemAutocompleteID).autocomplete({source:b.lookupURL,minLength:3,max:50,html:!0,select:function(a,c){jQuery.getJSON(b.itemInfoURL,{set_id:b.setID,table_num:b.table_num,row_id:c.item.id},function(a){"ok"!=a.status?alert("Error getting item information"):(b.addItemToSet(a.row_id,a,!0,!0),jQuery("#"+b.setItemAutocompleteID).attr("value",""))})}}),b.initialValues&&jQuery.each(b.initialValueOrder,function(a,c){b.addItemToSet(b.initialValues[c].row_id,b.initialValues[c],!1)}),b.refresh()},b.addItemToSet=function(a,c,d,e){if(d){var f=b.getRowIDs();if(-1!=jQuery.inArray(a,f))return!1}var g=c.representation_url||"";g&&b.editSetItemsURL&&(g="<div style=\"margin-left: 25px; background-image: url('"+g+"'); width: "+c.representation_width+"px; height: "+c.representation_height+'px;"> </div>');var h=c.item_id,i=a+(h>0?"_"+h:"");console.log("item="+h,a,i,g);var j="";b.editSetItemButton&&h>0&&(j='<div style="float: left;"><a href="'+b.editSetItemsURL+"/item_id/"+c.item_id+'" title="'+b.editSetItemToolTip+'" class="setItemEditButton">'+b.editSetItemButton+"</a></div> ");var k="<li class='setItem' id='"+b.fieldNamePrefix+"setItem"+i+"'><div id='"+b.fieldNamePrefix+"setItemContainer"+i+"' class='imagecontainer'>";return h>0&&(k+="<div class='remove'><a href='#' class='setDeleteButton' id='"+b.fieldNamePrefix+"setItemDelete"+h+"'>&nbsp;</a></div>"),k+="<div class='setItemThumbnail'>"+j+g+"</div><div class='setItemCaption'>"+c.set_item_label+" [<span class='setItemIdentifier'>"+c.idno+"</span>]</div><div class='setItemIdentifierSortable'>"+c.idno_sort+"</div></div><br style='clear: both;'/></li>",e?jQuery("#"+b.fieldNamePrefix+b.setItemListID).prepend(k):jQuery("#"+b.fieldNamePrefix+b.setItemListID).append(k),h>0&&b.setDeleteButton(a,h),d&&(b.refresh(),caUI.utils.showUnsavedChangesWarning(!0)),!0},b.setDeleteButton=function(a,c){var d=a+(c>0?"_"+c:"");jQuery("#"+b.fieldNamePrefix+"setItemDelete"+c).click(function(){return jQuery("#"+b.fieldNamePrefix+"setItem"+d).fadeOut(250,function(){jQuery("#"+b.fieldNamePrefix+"setItem"+d).remove(),b.refresh()}),caUI.utils.showUnsavedChangesWarning(!0),!1})},b.getRowIDs=function(){var a=[];return jQuery.each(jQuery("#"+b.fieldNamePrefix+b.setItemListID+" .setItem"),function(c,d){var e=jQuery(d).attr("id");e&&a.push(e.replace(b.fieldNamePrefix+"setItem",""))}),a},b.refresh=function(){jQuery("#"+b.fieldNamePrefix+b.setItemListID).sortable({opacity:.7,revert:!0,scroll:!0,update:function(){b.refresh(),caUI.utils.showUnsavedChangesWarning(!0)}}),jQuery("#"+b.fieldNamePrefix+b.setItemListID+" li.setItem").length?jQuery("#"+b.fieldNamePrefix+b.setNoItemWarningID).hide():jQuery("#"+b.fieldNamePrefix+b.setNoItemWarningID).show(),jQuery("#"+b.rowIDListID).val(b.getRowIDs().join(";"))},b.sort=function(a){var c={},d=null;switch(a){case"name":d="setItemCaption";break;case"idno":d="setItemIdentifierSortable";break;default:return!1}jQuery.each(jQuery("#"+b.fieldNamePrefix+b.setItemListID+" .setItem"),function(a,b){var e=jQuery(b).attr("id");if(e){var f=jQuery("#"+e+" .imagecontainer ."+d).text();c[f]=b}jQuery(b).remove()}),c=caUI.utils.sortObj(c,!0),jQuery.each(c,function(a,c){jQuery("#"+b.fieldNamePrefix+b.setItemListID).append(c);var d=jQuery(c).attr("id"),e=d.replace(b.fieldNamePrefix+"setItem",""),f=e.split(/_/);b.setDeleteButton(f[0],f[1])}),caUI.utils.showUnsavedChangesWarning(!0),b.refresh()},b.initSetEditor(),b}}(jQuery);var caUI=caUI||{};!function(a){caUI.initTableView=function(b,c){var d=jQuery.extend({container:b,initialData:null,rowCount:null,contextMenu:!1,columnSorting:!0,dataLoadUrl:null,dataSaveUrl:null,editLinkFormat:null,rowHeaders:null,colHeaders:null,columns:null,colWidths:null,currentRowClassName:"caResultsEditorCurrentRow",currentColClassName:"caResultsEditorCurrentCol",readOnlyCellClassName:"caResultsEditorReadOnlyCell",statusDisplayClassName:"caResultsEditorStatusDisplay",saveMessage:"Saving...",errorMessagePrefix:"[Error]",saveSuccessMessage:"Saved changes",lastLookupIDMap:null,saveQueue:[],saveQueueIsRunning:!1},c);d.htmlRenderer=function(a,b,c,e,f,g,h){return h.readOnly&&(b.className=d.readOnlyCellClassName),jQuery(b).empty().append(g),b},d.caResultsEditorOpenFullScreen=function(){var a=jQuery(d.container).data("handsontable");jQuery(d.container).toggleClass("caResultsEditorContentFullScreen"),caResultsEditorPanel.showPanel(),jQuery("#scrollingResults").toggleClass("caResultsEditorContainerFullScreen").prependTo("#caResultsEditorPanelContentArea"),jQuery(".caResultsEditorToggleFullScreenButton").hide(),jQuery("#caResultsEditorControls").show(),a.updateSettings({width:jQuery("#caResultsEditorPanelContentArea").width()-15,height:jQuery("#caResultsEditorPanelContentArea").height()-32}),jQuery(d.container).width(jQuery("#caResultsEditorPanelContentArea").width()-15).height(jQuery("#caResultsEditorPanelContentArea").height()-32).resize(),a.render()},d.caResultsEditorCloseFullScreen=function(a){a||caResultsEditorPanel.hidePanel();var b=jQuery(d.container).data("handsontable");jQuery("#scrollingResults").toggleClass("caResultsEditorContainerFullScreen").prependTo("#caResultsEditorWrapper"),jQuery(d.container).toggleClass("caResultsEditorContentFullScreen"),jQuery(".caResultsEditorToggleFullScreenButton").show(),jQuery("#caResultsEditorControls").hide(),b.updateSettings({width:740,height:500}),jQuery(d.container).width(740).height(500).resize(),b.render()},d.colWidths=[],jQuery.each(d.columns,function(b){switch(d.colWidths.push(200),d.columns[b].type){case"DT_SELECT":delete d.columns[b].type,d.columns[b].type="autocomplete",d.columns[b].editor="dropdown";break;case"DT_LOOKUP":var c=d.columns[b].data,e=d.columns[b].lookupURL,f=d.columns[b].list;d.columns[b]={data:c,type:"autocomplete",strict:!1,source:function(b,c){b&&a.ajax({url:e,data:{term:b,list:f,simple:0},success:function(a){console.log("r",a);var b=[];d.lastLookupIDMap={};for(var e in a)b.push(a[e].label),d.lastLookupIDMap[a[e].label]=e;b.length>0&&c(b)}})}};break;default:delete d.columns[b].type,d.columns[b].renderer=d.htmlRenderer}}),d.save=function(a){d.saveQueue.push(a),d._runSaveQueue()},d._runSaveQueue=function(){if(d.saveQueueIsRunning)return console.log("Queue is already running"),!1;d.saveQueueIsRunning=!0;var a=d.saveQueue;if(!a.length)return d.saveQueueIsRunning=!1,!1;var b=jQuery(d.container).data("handsontable"),c={},e={},f={};return jQuery.each(a,function(a,b){c[b.change[0][0]]=b.id,e[b.id]=b.change[0][0],f[b.change[0][0]]=b}),d.saveQueue=[],jQuery.getJSON(d.dataSaveUrl,{changes:a},function(a){if(a.errors&&a.errors instanceof Object){var c=[];jQuery.each(a.errors,function(a,g){c.push(d.errorMessagePrefix+": "+g.message),b.setDataAtRowProp(e[a],f[e[a]].change[0][1],f[e[a]].change[0][2],"external")}),jQuery("."+d.statusDisplayClassName).html(c.join("; "))}else jQuery("."+d.statusDisplayClassName).html(d.saveSuccessMessage),jQuery.each(a.messages,function(a,c){b.setDataAtRowProp(e[a],f[e[a]].change[0][1],c.value,"external")}),setTimeout(function(){jQuery("."+d.statusDisplayClassName).fadeOut(500)},5e3);d.saveQueueIsRunning=!1,d._runSaveQueue()}),!0};jQuery(d.container).handsontable({data:d.initialData,rowHeaders:d.rowHeaders,colHeaders:d.colHeaders,minRows:d.rowCount,maxRows:d.rowCount,contextMenu:d.contextMenu,columnSorting:d.columnSorting,currentRowClassName:d.currentRowClassName,currentColClassName:d.currentColClassName,stretchH:"all",columns:d.columns,colWidths:d.colWidths,dataLoadUrl:d.dataLoadUrl,editLinkFormat:d.editLinkFormat,statusDisplayClassName:d.statusDisplayClassName,onChange:function(a,b){if("loadData"!==b&&"updateAfterRequest"!==b&&"external"!==b){jQuery("."+d.statusDisplayClassName).html(d.saveMessage).fadeIn(500);var c=this.getDataAtRowProp(parseInt(a[0]),"item_id"),e=a[0]instanceof Array?a[0][1].split("-"):a[1].split("-"),f=e.shift(),g=e.join("-");d.lastLookupIDMap&&d.lastLookupIDMap[a[0][3]]&&(a[0][3]=d.lastLookupIDMap[a[0][3]]),d.lastLookupIDMap=null,d.save({table:f,bundle:g,id:c,value:a[0][3],change:a,source:b})}}});return d}}(jQuery);var caUI=caUI||{};!function(){caUI.initUniquenessChecker=function(a){var b=jQuery.extend({errorIcon:null,processIndicator:null,statusID:"status",lookupUrl:null,formElementID:null,separator:".",table_num:null,row_id:null,field:null,withinFields:{},alreadyInUseMessage:"value is already in use"},a);return b.checkValue=function(){jQuery("#"+b.statusID).html(b.processIndicator?"<img src='"+b.processIndicator+"' border='0'/>":"");var a=jQuery("#"+b.formElementID).val();jQuery.getJSON(b.lookupUrl,{n:a,table_num:b.table_num,id:b.row_id,field:b.field,withinFields:b.withinFields},function(a){if(a.length>1&&-1===jQuery.inArray(b.row_id,a)||1==a.length&&parseInt(a)!=parseInt(b.row_id)){var c=b.alreadyInUseMessage;jQuery("#"+b.statusID).html((b.errorIcon?"<img src='"+b.errorIcon+"' border='0'/> ":"")+c).show(0)}else jQuery("#"+b.statusID).html("").hide(0)})},jQuery("#"+b.formElementID).bind("change keyup",b.checkValue),b.checkValue(),b}}(jQuery);var caUI=caUI||{};!function(){caUI.initUtils=function(a){var b=jQuery.extend({unsavedChangesWarningMessage:"You have made changes in this form that you have not yet saved. If you navigate away from this form you will lose your unsaved changes.",disableUnsavedChangesWarning:!1},a);return b.showUnsavedChangesWarningFlag=!1,caUI.utils={},caUI.utils.showUnsavedChangesWarning=function(a){return void 0===a&&(a=!0),b.showUnsavedChangesWarningFlag=a?!0:!1,this},caUI.utils.shouldShowUnsavedChangesWarning=function(){return b.showUnsavedChangesWarningFlag},caUI.utils.getUnsavedChangesWarningMessage=function(){return b.unsavedChangesWarningMessage},caUI.utils.disableUnsavedChangesWarning=function(a){b.disableUnsavedChangesWarning=a?!0:!1},caUI.utils.getDisableUnsavedChangesWarning=function(){return b.disableUnsavedChangesWarning},window.onbeforeunload=function(){return!caUI.utils.getDisableUnsavedChangesWarning()&&caUI.utils.shouldShowUnsavedChangesWarning()?caUI.utils.getUnsavedChangesWarningMessage():void 0},caUI.utils.sortObj=function(a,b){var c=new Array,d={};for(var e in a)c.push(e);b?c.sort(caUI.utils._caseInsensitiveSort):c.sort();for(var e in c)d[c[e]]=a[c[e]];return d},caUI.utils._caseInsensitiveSort=function(a,b){var c=0;return a=a.toLowerCase(),b=b.toLowerCase(),a>b&&(c=1),b>a&&(c=-1),c},caUI.utils.updateStateProvinceForCountry=function(a){var b=a.data,c=b.stateProvID,d=b.countryID,e=b.statesByCountryList,f=b.value,g=b.mirrorStateProvID,h=b.mirrorCountryID,i=jQuery("#"+c+"_select").val();jQuery("#"+c+"_select").empty();var j=jQuery("#"+d).val();if(e[j]){for(k in e[j])jQuery("#"+c+"_select").append('<option value="'+e[j][k]+'">'+k+"</option>"),f||i!=e[j][k]||(f=i);jQuery("#"+c+"_text").css("display","none").attr("name",c+"_text"),jQuery("#"+c+"_select").css("display","inline").attr("name",c).val(f),h&&(jQuery("#"+c+"_select").change(function(){jQuery("#"+g+"_select").val(jQuery("#"+c+"_select").val())}),jQuery("#"+h+"_select").val(jQuery("#"+d+"_select").val()),caUI.utils.updateStateProvinceForCountry({data:{stateProvID:g,countryID:h,statesByCountryList:e,value:f}}))}else jQuery("#"+c+"_text").css("display","inline").attr("name",c),jQuery("#"+c+"_select").css("display","none").attr("name",c+"_select"),h&&(jQuery("#"+c+"_text").change(function(){jQuery("#"+g+"_text").val(jQuery("#"+c+"_text").val())
}),jQuery("#"+h+"_select").attr("selectedIndex",jQuery("#"+d+"_select").attr("selectedIndex")),caUI.utils.updateStateProvinceForCountry({data:{stateProvID:g,countryID:h,statesByCountryList:e}}))},caUI.utils.formatFilesize=function(a){return a=a>=1073741824?caUI.utils.formatNumber(a/1073741824,2,".","")+" Gb":a>=1048576?caUI.utils.formatNumber(a/1048576,2,".","")+" Mb":a>=1024?caUI.utils.formatNumber(a/1024,0)+" Kb":caUI.utils.formatNumber(a,0)+" bytes"},caUI.utils.formatNumber=function(a,b,c,d){var e=a,f=isNaN(b=Math.abs(b))?2:b,g=void 0==c?",":c,h=void 0==d?".":d,i=0>e?"-":"",j=parseInt(e=Math.abs(+e||0).toFixed(f))+"",k=(k=j.length)>3?k%3:0;return i+(k?j.substr(0,k)+h:"")+j.substr(k).replace(/(\d{3})(?=\d)/g,"$1"+h)+(f?g+Math.abs(e-j).toFixed(f).slice(2):"")},caUI.utils.getAcrobatInfo=function(){var a=function(){return this.name=this.name||function(){var a=navigator?navigator.userAgent.toLowerCase():"other";return a.indexOf("chrome")>-1?"chrome":a.indexOf("safari")>-1?"safari":a.indexOf("msie")>-1?"ie":a.indexOf("firefox")>-1?"firefox":a}()},b=function(a){try{return new ActiveXObject(a)}catch(b){}},c=function(a){for(key in navigator.plugins){var b=navigator.plugins[key];if(b.name==a)return b}},d=function(){return this.plugin=this.plugin||function(){return"ie"==a()?b("AcroPDF.PDF")||b("PDF.PdfCtrl"):c("Adobe Acrobat")||c("Chrome PDF Viewer")||c("WebKit built-in PDF")}()},e=function(){return!!d()},f=function(){try{var b=d();if("ie"==a()){var c=b.GetVersions().split(","),e=c[0].split("=");return parseFloat(e[1])}return b.version?parseInt(b.version):b.name}catch(f){return null}};return{browser:a(),acrobat:e()?"installed":!1,acrobatVersion:f()}},b}}(jQuery),$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};var caUI=caUI||{};!function(){caUI.initWidgetPanel=function(a){var b=jQuery.extend({widgetUrl:"",panelCSSClass:"browseSelectPanel",useExpose:!0,isChanging:!1},a);return b.showWidgetPanel=function(){b.isChanging=!0,jQuery("#dashboardWidgetPanel").fadeIn(200,function(){b.isChanging=!1}),b.useExpose&&jQuery("#dashboardWidgetPanel").expose({api:!0,color:"#000000",opacity:.5}).load(),jQuery("#dashboardWidgetPanelContent").load(b.widgetUrl,{})},b.hideWidgetPanel=function(){b.isChanging=!0,jQuery("#dashboardWidgetPanel").fadeOut(200,function(){b.isChanging=!1}),b.useExpose&&jQuery.mask.close(),jQuery("#dashboardWidgetPanelContent").empty()},b.WidgetPanelIsVisible=function(){return jQuery("#dashboardWidgetPanel:visible").length>0?!0:!1},jQuery(document).ready(function(){jQuery(document).click(function(a){var c=jQuery(a.target).parents().map(function(){return this.id}).get();!b.isChanging&&b.WidgetPanelIsVisible()&&-1==jQuery.inArray("dashboardWidgetPanel",c)&&b.hideWidgetPanel()}),jQuery(document).keyup(function(a){27==a.keyCode&&!b.isChanging&&b.WidgetPanelIsVisible()&&b.hideWidgetPanel()})}),b}}(jQuery);